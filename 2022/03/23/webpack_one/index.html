<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>webpack源码系列(往)：开篇 | Mr.Yellow.Wills</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="webpack,webpack源码系列">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.3.9">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Mr.Yellow</h5>
          <a href="mailto:601661706@qq.com" title="601661706@qq.com" class="mail">
            
              <span>6</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>0</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/YeWills/YeWills.github.io/tree/blog_code" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>webpack源码系列(往)：开篇</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">webpack源码系列(往)：开篇</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-03-23T00:00:00.000Z" itemprop="datePublished" class="page-time">
  2022-03-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/webpack源码系列/">webpack源码系列</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-webpack_one"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">webpack源码系列(往)：开篇</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-03-23 00:00:00" datetime="2022-03-23T00:00:00.000Z"  itemprop="datePublished">2022-03-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/webpack源码系列/">webpack源码系列</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p><em>往蹇来誉 田获三狐</em></p>
<p>懂webpack配置不难，但webpack升级后，旧的经验很容易出问题，且webpack像一个黑箱，难以解决。<br>webpack配置学习三个月，升级之后又三个月，没完没了，没有尽头。<br>为此决定一改以往学习webpack配置的策略，<br>改为直接学习webpack调试经验以及了解其源码和原理，<br>以便出现问题或需求，可以直抵关键，一击必中。</p>
<h2 id="webpack源码学习策略"><a href="#webpack源码学习策略" class="headerlink" title="webpack源码学习策略"></a>webpack源码学习策略</h2><h3 id="为什么要学源码"><a href="#为什么要学源码" class="headerlink" title="为什么要学源码"></a>为什么要学源码</h3><p>以前我鄙视看 react 或 webpack源码<br>现在改变了，react基本上不会出故障，出故障需要调试源码的情况出现非常少，而且react不像webpack有这个一大堆配置，<br>用起来十分简单，稳定，很少出现需要分析的故障，<br>权衡 学习react源码成本与受益，确实受益比不高，没有学react必要。</p>
<p>但webpack不同，它有繁多的配置，每一种配置 对应不同的产物。<br>而且每种配置都对应了几种配置方式，可能是字符串，可能是数组，还可能是对象，更甚着，还有带特殊符号的 字符串 配置方式，<br>比如 <code>!babel-loader filepath</code> 等等。<br>经常我们配置后，最后编译的结果与我们期待的差异很大，<br>遇到问题，webpack简直是一个黑箱 无法查起，<br>大大增加了开发的成本 和不便。</p>
<p>而且webpack编译问题，经常碰到。</p>
<p>考虑到学习成本和受益，还是可以尝试学习 webpack源码的。</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>以问题点问切入方式；</p>
<p>先列出 webpack 一百问；</p>
<p>以问的方式，或者以解决日常问题点的方式 去看源码；<br>然后展开；<br>将此过程记录；</p>
<p>或者 对照 webpack 使用视频 去了解webpack的使用；<br>然后针对使用 去看源码；</p>
<p>目前的策略 就是游击战术；<br>以官网的api 使用方法为切入点，<br>看源码，<br>当webpack源码看得体系后，<br>再系统看看？</p>
<p>本次看webpack 源码的目的：<br>遇到问题知道怎么分析。<br>了解plugin写法；<br>了解loader写法；<br>了解tapable；<br>webpack 打包的主流程；<br>webpack 一切都是module 的理解；<br>大致看一遍官网，进行系统快速了解下；</p>
<p>列举下当前 自己最关心的几个webpack问题，解决后 开始学习babel， 接着umi学习。</p>
<p>然后学习 umi；</p>
<p>学东西不学源码，确实不好。</p>
<h3 id="需要了解的一览"><a href="#需要了解的一览" class="headerlink" title="需要了解的一览"></a>需要了解的一览</h3><p>除了上面所说的，想了解的问题：</p>
<ul>
<li>想要了解 webpack 自己的 require 或 import 的实现。 （这其实就是主流程）；<br>可以针对 一个简单的代码，编译后，看编译后的源码是怎样的。<br>这个可能通过这篇博客 来分析： <a href="https://segmentfault.com/a/1190000039957527" target="_blank" rel="noopener">https://segmentfault.com/a/1190000039957527</a><!-- 里面有关于__webpack_require__ 的实现。 -->
</li>
</ul>
<h3 id="学习历程"><a href="#学习历程" class="headerlink" title="学习历程"></a>学习历程</h3><h4 id="2022-3-28以前"><a href="#2022-3-28以前" class="headerlink" title="2022-3-28以前"></a>2022-3-28以前</h4><p>教程视频<br><a href="https://www.bilibili.com/video/BV12L411t7Pr?spm_id_from=333.999.0.0" target="_blank" rel="noopener">https://www.bilibili.com/video/BV12L411t7Pr?spm_id_from=333.999.0.0</a></p>
<p>compiler 与 compilation 区别和联系<br>手写简易版本的打包器 (ast 抽象语法树， dom树)<br>loader(ast)<br>plugin</p>
<h4 id="2022-3-28"><a href="#2022-3-28" class="headerlink" title="2022-3-28"></a>2022-3-28</h4><p>今晚要做的是，做笔记；<br>看视频做笔记；<br>然后将最近这几天的内容 整理笔记；<br>包括之前源码调试；<br>—-和今天的parse；—-</p>
<p>做完之后，收集一波webpack 资料<br>然后再制定一个三天计划。</p>
<p>webpack 源码学习资料确实太匮乏，无太多经验可借鉴<br>，只能边做边计划。<br>做完一个阶段，然后 计划下一个阶段</p>
<p>后期看下 loaderRunner 的实现？</p>
<p>要做的就是 对最近的webpack 做一轮复盘总结</p>
<h4 id="2022-3-29"><a href="#2022-3-29" class="headerlink" title="2022-3-29"></a>2022-3-29</h4><p>一个js文件，是在哪里被 fs 读取的；</p>
<h4 id="2022-3-31"><a href="#2022-3-31" class="headerlink" title="2022-3-31"></a>2022-3-31</h4><p>然后看视频 看手写一个打包器；<br>或者看手写一个plugin；<br>看手写也好，还是什么也好，<br>通过这些示例或者视频，你至少知道怎么用了，它们就是一个源码的 活生生的说明书，然后再去看源码是不是事半功倍！</p>
<h4 id="2022-4-1"><a href="#2022-4-1" class="headerlink" title="2022-4-1"></a>2022-4-1</h4><p>今天找了一波资料，有视频 还有文档的；<br>先大量快刷一波 视频，优先看公开课的webpack源码视频，刷完后；<br>再刷 源码解读文档；<br>然后自己再试试 看webpack源码</p>
<p>是不是可以针对webpack 的各个目录 做个说明。</p>
<p>感觉webpack 前期的游击式打法也重要，对细节比较熟练了；<br>然后再找一个 视频或文档的教程，好的教程，会让你看源码事半功倍；<br>我这次是看的一个文档教程，也不错，挺好的<br>以后可以按这个策略来</p>
<h4 id="2022-4-2"><a href="#2022-4-2" class="headerlink" title="2022-4-2"></a>2022-4-2</h4><p>摘录至<a href="https://github.com/lizuncong/mini-webpack" target="_blank" rel="noopener">https://github.com/lizuncong/mini-webpack</a><br>思考以下几个问题<br>webpack options默认值是什么时候设置的<br>webpack 插件初始化是什么时候设置的<br>chunk 和 module的关联是咋样的<br>webpack loader的执行时机<br>webpack plugin的执行时机<br>webpack是如何解析模块的，即当我们通过require(‘./test.js’)引入一个模块后，webpack是如何查找对应的文件的<br>webpack如何解析模块依赖的<br>webpack如何构建模块<br>webpack模版代码如何生成</p>
<p>目前的想法是，webpack 5 的源码 将近是 webpack 4 的两倍，<br>webpack 5 核心代码之外加了太多花里胡哨的东西，关键的东西因此被隐藏很深，所以舍去 webpack 5 ，<br>先看webpack 4 ，以求入门webpack 源码，<br>后期再考虑 webpack 5 ，<br>一步步来。<br>因为原理是相通的</p>
<p>我觉得看webpack源码，要解决以下几个问题才算成功：<br>了解上面说的 chunk 与 module 的区别；<br>以及一些webpack 核心概念 比如一切都是chunk<br>或者看webpack 官网文档， 看官网的一些核心概念，自己是否理解了。</p>
<p>另外说一点感受，发现 涉及复杂源码的时候，<br>好视频是早期用来培养球感的；<br>深入的时候，需要文档教程；<br>到最后就是自己看源码；</p>
<h4 id="2022-4-6"><a href="#2022-4-6" class="headerlink" title="2022-4-6"></a>2022-4-6</h4><p>明天看的思路<br>重点攻击 module 的生成(含递归)<br>这部分，目前是我已知的最难点，</p>
<p>为了保证 阅读源码顺利，<br>先把之前看的有关webpack 这部分的源码接口，重新读一遍，<br>并做下笔记，或者直接以 笔记的方式写到本博客中，<br>然后对整个过程了然于心的时候，<br>不看源码的情况下，已经非常熟练的时候，<br>就可以看源码了</p>
<h4 id="2022-4-7"><a href="#2022-4-7" class="headerlink" title="2022-4-7"></a>2022-4-7</h4><p>昨天看完 module 模块；<br>现在看 chunk部分；</p>
<h4 id="2022-4-11"><a href="#2022-4-11" class="headerlink" title="2022-4-11"></a>2022-4-11</h4><p>源码链路走完后，<br>暂时文档次之，<br>阅读 webpack 官方文档，<br>全部过一遍，并且将之前自认为难的地方，重点攻坚下，结合源码理解。</p>
<p>等全部好了后，再做一个详细的文档。</p>
<h4 id="2022-4-12"><a href="#2022-4-12" class="headerlink" title="2022-4-12"></a>2022-4-12</h4><p>目前刚阅读完源码，<br>计划 找一个webpack视频教程跟着走一遍；<br>然后 把webapck官网文档全部看一遍；<br>跟着就搞下babel；<br>为了加快webpack核心目标-（学习webpack为我所用，为实际项目所用），<br>考虑到现实环境，<br>官网中一些项目遇到不多的，不太阻碍主流程的，以及可等待实际项目遇到后再研究的，<br>可略过不看，不过要在笔记中，以待研究做笔记记录。<br>目前的目标是，既要保证学习的质量，又要兼顾上述核心目标，即快、快效率。<br>要避免陷入 钻牛角尖的陷阱。</p>
<h4 id="2022-4-13"><a href="#2022-4-13" class="headerlink" title="2022-4-13"></a>2022-4-13</h4><p>【从 昨天 4月12日 开始 看官网源码】<br>官网阅读策略：<br>阅读顺序如下：<br>概念<br>api<br>指南<br>配置<br>loader<br>plugin</p>
<p>先看官网吧，先把官网刷一遍，<br>然后再看视频。这样可能更加有感觉。<br>然后再 视频和官网 来回穿插看，<br>或者对官网进行扫盲，或者找几个重难点进行演练。</p>
<h4 id="2022-4-14"><a href="#2022-4-14" class="headerlink" title="2022-4-14"></a>2022-4-14</h4><p>昨天因为其他事情，中断一天时间，没有看webpack；<br>目前先看webpack官网，再看视频教程 这一安排还是非常有效率的。<br>因为之前都是先看视频教程，再看或不看官网，<br>视频教程再系统，确实也比不上官网系统。</p>
<p>而且官网教程 都以文字的方式记录，<br>如果webpack知识丰富，或者看过源码后，再读官网，确实要轻松很多。<br>这个时候，【文档教程相比视频教程的优势来了】：<br>快速定位；<br>文档在任何场合都可以看；<br>停和开始非常便捷；<br>文档天生就是做好的笔记，二次笔记非常方便；<br>文档阅读速度快</p>
<p>所以建议 对某个知识点足够熟悉的时候，读文档或官网，比视频好。</p>
<p>【而且读webpack官网 阅读顺序非常重要】，我这次阅读顺序非常妙和好，<br>目前看了 概念、api、指南。<br>再次来过，顺序还是建议用上面的顺序</p>
<h4 id="2022-4-20"><a href="#2022-4-20" class="headerlink" title="2022-4-20"></a>2022-4-20</h4><p>昨天中断一天没有看webpack官网，<br>到今天 webpack官网全部看完：<br>概念<br>api<br>指南<br>配置<br>loader<br>plugin<br>概念、api、指南、配置 细看了；<br>loader、plugin 扫了一眼，主要讲各个loader plugin的使用方法，看的价值不高，用的时候再看比较好，这两个只花了两个小时看完。</p>
<p>这一次的 webpack之旅：<br>webpack的学习时间 从 3月1日开始，<br>至今 4月12日，中间去掉几天，一共花了一个月 3天<br>这是看webpack 源码的时间，包含了大量的源码阅读的准备工作，比如充分了解 loader、plugin的使用，手写webpack源码。<br>从 4月12-20日，花了9天时间看官网，其中中断了两天时间，以及周末未看。</p>
<p>这次webpack 之旅 总耗时:<br>1个月 3天 + 9天 = 合计 1月 12 天</p>
<p>虽然耗时很长，但是收获也是非常大的，而且将自己的前端眼界提高一个台阶，非常值得。</p>
<p>一路走来不易，为这一个半月喝一杯。</p>
<h3 id="当前要做"><a href="#当前要做" class="headerlink" title="当前要做"></a>当前要做</h3><p>2022-3-31<br>里面有关于<strong>webpack_require</strong> 的实现；<br>找各种视频或源码资料；<br>然后制定下一次的计划，<br>利用这次清明节的时间，攻坚最难的源码，但在节前，<br>希望做好 “球感” 培养好，以及充分阅读各种资料视频。</p>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>目前两个demo库用于webpack学习</p>
<h3 id="webpack源码库"><a href="#webpack源码库" class="headerlink" title="webpack源码库"></a>webpack源码库</h3><p><a href="https://github.com/YeWills/webpack/tree/version-debug-5.69.1" target="_blank" rel="noopener">webpack</a>  fork自webpack官网，主要用于阅读webpack源码，或者直接用源码进行编译调试。<br>此库可以用于同步最新的webpack修改，并同时查看各个版本的webapck源码。</p>
<h4 id="version-debug-5-69-1-分支"><a href="#version-debug-5-69-1-分支" class="headerlink" title="version-debug-5.69.1 分支"></a>version-debug-5.69.1 分支</h4><p>其中分支可以使用此库 <a href="https://github.com/YeWills/webpack/tree/version-debug-5.69.1" target="_blank" rel="noopener">分支 version-debug-5.69.1 </a> 进行webpack源码调试<br>里面包含了如何改造webpack官库 用于直接编译调试的经验，</p>
<p>关于此分支的更多讲解，参考下面的 《参考 -  webpack5调试经验分享视频》</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li><a href="https://www.bilibili.com/video/av462922583?from=search&amp;seid=14121423744670771391&amp;spm_id_from=333.337.0.0" target="_blank" rel="noopener">webpack5调试经验分享视频</a></li>
</ul>
<h3 id="webpack调试库"><a href="#webpack调试库" class="headerlink" title="webpack调试库"></a>webpack调试库</h3><p><a href="https://github.com/YeWills/webpack-travel" target="_blank" rel="noopener">webpack调试库</a> ,此库展示webpack用于各种场景下调试练手。</p>
<h2 id="三种webpack配置模式"><a href="#三种webpack配置模式" class="headerlink" title="三种webpack配置模式"></a>三种webpack配置模式</h2><ul>
<li><ol>
<li>compiler 模式；</li>
</ol>
</li>
<li><ol start="2">
<li>webpack config 模式；</li>
</ol>
</li>
<li><ol start="3">
<li>webpack-dev-server config 模式；</li>
</ol>
</li>
</ul>
<p>本质上 2 最终还是用 1 实现；<br>3 最终变成 2，最终依然还是基于 1 实现；<br>本质上 他们最终都是用 compiler模式实现</p>
<h3 id="webpack入口"><a href="#webpack入口" class="headerlink" title="webpack入口"></a>webpack入口</h3><ul>
<li>执行npm run build  最终找到 bin/webpack.js<br>上述的文件里其实就是判断 webpack-cli 是否安装，如果安装了则执行 runCli 方法<br>在 runCli 方法里加载了 webpack-cli/bin/cli.js<br>在cli.js 当中核心就是判断 webpack 是否安装了，如果安装了 则执行 runCli<br>在runCli 里处理命令行参数 （依赖了commander），执行 new WebpackCli 的时候会去触发 action 回调；<br>this.program.action() ，而这个this.program = program(commander)<br>action的回调当中执行了 loadCommandByName-》makeCommand-&gt;runWebpack<br>runWebpack()的时候执行了 createCompiler()<br>在createCompiler 内部调用了 webpack 方法， 接收配置文件和回调，最终生成了一个compiler对象，而这个compiler对象会在上述的调用过程中被返回，它就是我们webpack 打包的第一个核心的有关“人员”<br>上面的 webpack 就是我们本地安装好的 webpack<br>如果想让webpack 打包，其实就是使用 webpack 函数来接收 config，然后调用 run 方法即可。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./webpack.config'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(config)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">compiler.run(<span class="function">(<span class="params">err, stats</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">11</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="webpack-dev-server-调试-待进一步整理"><a href="#webpack-dev-server-调试-待进一步整理" class="headerlink" title="webpack-dev-server 调试 (待进一步整理)"></a>webpack-dev-server 调试 (待进一步整理)</h3><p>本例以传统的webpack 配置模式进行, webpack-dev-server 启动。</p>
<p>webpack-dev-server 启动与 webpack 的区别</p>
<p><a rel=webpack源码系列(往)：开篇 href="/image/webpack_one/entry.jpg" title="" data-fancybox="images"><img src="/image/webpack_one/entry.jpg" alt></a></p>
<h4 id="lib-webpack-js"><a href="#lib-webpack-js" class="headerlink" title="lib\webpack.js"></a>lib\webpack.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">node_modules\webpack\lib\webpack.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="function">(<span class="params">options, callback</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    compiler = <span class="keyword">new</span> Compiler(options.context);</span><br><span class="line">    compiler.options = options;</span><br><span class="line">    <span class="keyword">new</span> NodeEnvironmentPlugin(&#123;</span><br><span class="line">        infrastructureLogging: options.infrastructureLogging</span><br><span class="line">    &#125;).apply(compiler);</span><br><span class="line">    <span class="keyword">if</span> (options.plugins &amp;&amp; <span class="built_in">Array</span>.isArray(options.plugins)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.plugins) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  这里加载插件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">"function"</span>) &#123;</span><br><span class="line">                plugin.call(compiler, compiler);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                plugin.apply(compiler);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compiler.hooks.environment.call();</span><br><span class="line">    compiler.hooks.afterEnvironment.call();</span><br><span class="line">    <span class="comment">// 这里执行compiler的后续操作</span></span><br><span class="line">    compiler.options = <span class="keyword">new</span> WebpackOptionsApply().process(options, compiler);</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-WebpackOptionsApply-js"><a href="#webpack-lib-WebpackOptionsApply-js" class="headerlink" title="webpack\lib\WebpackOptionsApply.js"></a>webpack\lib\WebpackOptionsApply.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接上面 compiler.options = new WebpackOptionsApply().process(options, compiler);</span></span><br><span class="line"><span class="comment">// node_modules\webpack\lib\WebpackOptionsApply.js  process</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> EntryOptionPlugin().apply(compiler);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----WebpackOptionsApply^process^compiler.hooks.entryOption.call -- start -------</span></span><br><span class="line"><span class="comment">// 后续讲 ，目前先讲解上面的 EntryOptionPlugin().apply(compiler);</span></span><br><span class="line">compiler.hooks.entryOption.call(options.context, options.entry);</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-EntryOptionPlugin-js"><a href="#webpack-lib-EntryOptionPlugin-js" class="headerlink" title="webpack\lib\EntryOptionPlugin.js"></a>webpack\lib\EntryOptionPlugin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接上面 new EntryOptionPlugin().apply(compiler);</span></span><br><span class="line"><span class="comment">// node_modules\webpack\lib\EntryOptionPlugin.js  process</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> EntryOptionPlugin().apply(compiler);</span><br><span class="line"></span><br><span class="line">apply(compiler) &#123;</span><br><span class="line">		compiler.hooks.entryOption.tap(<span class="string">"EntryOptionPlugin"</span>, (context, entry) =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">typeof</span> entry === <span class="string">"string"</span> || <span class="built_in">Array</span>.isArray(entry)) &#123;</span><br><span class="line">				itemToPlugin(context, entry, <span class="string">"main"</span>).apply(compiler);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> entry === <span class="string">"object"</span>) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">of</span> <span class="built_in">Object</span>.keys(entry)) &#123;</span><br><span class="line">					itemToPlugin(context, entry[name], name).apply(compiler);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> entry === <span class="string">"function"</span>) &#123;</span><br><span class="line">				<span class="keyword">new</span> DynamicEntryPlugin(context, entry).apply(compiler);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-SingleEntryPlugin-js"><a href="#webpack-lib-SingleEntryPlugin-js" class="headerlink" title="webpack\lib\SingleEntryPlugin.js"></a>webpack\lib\SingleEntryPlugin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">itemToPlugin -》 SingleEntryPlugin</span><br><span class="line"><span class="comment">// =》js</span></span><br><span class="line"><span class="comment">// node_modules\webpack\lib\SingleEntryPlugin.js</span></span><br><span class="line">	apply(compiler) &#123;</span><br><span class="line">		compiler.hooks.compilation.tap(</span><br><span class="line">			<span class="string">"SingleEntryPlugin"</span>,</span><br><span class="line">			(compilation, &#123; normalModuleFactory &#125;) =&gt; &#123;</span><br><span class="line">                <span class="comment">// 通过 SingleEntryDependency 这个构造函数 set 唯一key value，获取对应value ，与下面对应</span></span><br><span class="line">				compilation.dependencyFactories.set(</span><br><span class="line">					SingleEntryDependency,</span><br><span class="line">					normalModuleFactory</span><br><span class="line">				);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">		compiler.hooks.make.tapAsync(</span><br><span class="line">			<span class="string">"SingleEntryPlugin"</span>,</span><br><span class="line">			(compilation, callback) =&gt; &#123;</span><br><span class="line">				<span class="keyword">const</span> &#123; entry, name, context &#125; = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">                 <span class="comment">// 后期可通过 dep.constructor 对应上面的key，获取 set 的value    </span></span><br><span class="line">				<span class="keyword">const</span> dep = SingleEntryPlugin.createDependency(entry, name);</span><br><span class="line">				compilation.addEntry(context, dep, name, callback);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>entry entry request</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param <span class="type">&#123;string&#125;</span> </span>name entry name</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@returns <span class="type">&#123;SingleEntryDependency&#125;</span> </span>the dependency</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> createDependency(entry, name) &#123;</span><br><span class="line">        <span class="comment">// SingleEntryDependency new后的结果 dep ，后期可通过 dep.constructor 对应上面的key，获取 set 的value</span></span><br><span class="line">		<span class="keyword">const</span> dep = <span class="keyword">new</span> SingleEntryDependency(entry);</span><br><span class="line">		dep.loc = &#123; name &#125;;</span><br><span class="line">		<span class="keyword">return</span> dep;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -----WebpackOptionsApply^process^compiler.hooks.entryOption.call -- end -------</span></span><br><span class="line"><span class="comment">// 后续讲 ，目前先讲解上面的 EntryOptionPlugin().apply(compiler);</span></span><br><span class="line">compiler.hooks.entryOption.call(options.context, options.entry);</span><br><span class="line"><span class="comment">// 其实就是触发上面的 compiler.hooks.entryOption.tap("EntryOptionPlugin", // node_modules\webpack\lib\EntryOptionPlugin.j</span></span><br><span class="line"><span class="comment">// 继续 tap 更多的 事件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  这个是 LoaderPlugin 的处理？？？</span></span><br><span class="line"><span class="keyword">new</span> LoaderPlugin().apply(compiler);</span><br></pre></td></tr></table></figure>
<p><code>node_modules\webpack\lib\WebpackOptionsApply.js</code><br>这个文件主要用于 订阅 各种事件，比如你设置了一个配置，<br>这个配置最终转换为一个plugin，<br>然后再plugin的apply中 tap 一个事件，<br>这个tap事件，可能是compiler或compiletion 的某个生命周期 或 等待后期被 call。</p>
<p>从这个角度讲， WebpackOptionsApply 应该是各种插件plugin 大集合 的位置。</p>
<p>同时在这里 触发了多个 事件(生命周期)<br>compiler.hooks.afterPlugins.call(compiler);<br>compiler.hooks.afterResolvers.call(compiler);</p>
<p>webpack-dev-server 通过 Server.js 触发 最终的webpack config？</p>
<p>例如 <code>compiler.hooks.entryOption.call(config.context, config.entry);</code>执行</p>
<h4 id="webpack-dev-middleware-index-js"><a href="#webpack-dev-middleware-index-js" class="headerlink" title="webpack-dev-middleware\index.js"></a>webpack-dev-middleware\index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  node_modules\webpack-dev-middleware\index.js</span></span><br><span class="line"></span><br><span class="line"> compiler.watch</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-Compiler-js"><a href="#webpack-lib-Compiler-js" class="headerlink" title="webpack\lib\Compiler.js"></a>webpack\lib\Compiler.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">node_modules\webpack\lib\Compiler.js</span><br><span class="line"> 	watch(watchOptions, handler) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.running) <span class="keyword">return</span> handler(<span class="keyword">new</span> ConcurrentCompilationError());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.running = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">this</span>.watchMode = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">this</span>.fileTimestamps = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">		<span class="keyword">this</span>.contextTimestamps = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">		<span class="keyword">this</span>.removedFiles = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Watching(<span class="keyword">this</span>, watchOptions, handler);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-Watching-js"><a href="#webpack-lib-Watching-js" class="headerlink" title="webpack\lib\Watching.js"></a>webpack\lib\Watching.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node_modules\webpack\lib\Watching.js</span><br><span class="line">    	<span class="keyword">this</span>.compiler.readRecords(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>._go();</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-Compiler-js-1"><a href="#webpack-lib-Compiler-js-1" class="headerlink" title="webpack\lib\Compiler.js"></a>webpack\lib\Compiler.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">        node_modules\webpack\lib\Compiler.js</span><br><span class="line"></span><br><span class="line">        	readRecords(callback) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="keyword">this</span>.recordsInputPath) &#123;</span><br><span class="line">			<span class="keyword">this</span>.records = &#123;&#125;;</span><br><span class="line">			<span class="keyword">return</span> callback();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上面的 <span class="keyword">this</span>._go();</span><br><span class="line">        <span class="keyword">this</span>.compiler.hooks.watchRun.callAsync(<span class="keyword">this</span>.compiler, err =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line">			<span class="keyword">const</span> onCompiled = <span class="function">(<span class="params">err, compilation</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>.invalid) <span class="keyword">return</span> <span class="keyword">this</span>._done();</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">this</span>.compiler.hooks.shouldEmit.call(compilation) === <span class="literal">false</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">this</span>._done(<span class="literal">null</span>, compilation);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">this</span>.compiler.emitAssets(compilation, err =&gt; &#123;</span><br><span class="line">					<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line">					<span class="keyword">if</span> (<span class="keyword">this</span>.invalid) <span class="keyword">return</span> <span class="keyword">this</span>._done();</span><br><span class="line">					<span class="keyword">this</span>.compiler.emitRecords(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line"></span><br><span class="line">						<span class="keyword">if</span> (compilation.hooks.needAdditionalPass.call()) &#123;</span><br><span class="line">							compilation.needAdditionalPass = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">							<span class="keyword">const</span> stats = <span class="keyword">new</span> Stats(compilation);</span><br><span class="line">							stats.startTime = <span class="keyword">this</span>.startTime;</span><br><span class="line">							stats.endTime = <span class="built_in">Date</span>.now();</span><br><span class="line">							<span class="keyword">this</span>.compiler.hooks.done.callAsync(stats, err =&gt; &#123;</span><br><span class="line">								<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line"></span><br><span class="line">								<span class="keyword">this</span>.compiler.hooks.additionalPass.callAsync(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">									<span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="keyword">this</span>._done(err);</span><br><span class="line">									<span class="keyword">this</span>.compiler.compile(onCompiled);</span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;);</span><br><span class="line">							<span class="keyword">return</span>;</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">return</span> <span class="keyword">this</span>._done(<span class="literal">null</span>, compilation);</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;;</span><br><span class="line">            &lt;!-- 回调中执行 --&gt;</span><br><span class="line">			<span class="keyword">this</span>.compiler.compile(onCompiled);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            node_modules\webpack\lib\Compiler.js</span><br><span class="line">            compile(callback) &#123;</span><br><span class="line">		<span class="keyword">const</span> params = <span class="keyword">this</span>.newCompilationParams();</span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeCompile.callAsync(params, err =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.hooks.compile.call(params);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">const</span> compilation = <span class="keyword">this</span>.newCompilation(params);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.hooks.make.callAsync(compilation, err =&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">				compilation.finish(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">					compilation.seal(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">						<span class="keyword">this</span>.hooks.afterCompile.callAsync(compilation, err =&gt; &#123;</span><br><span class="line">							<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">							<span class="keyword">return</span> callback(<span class="literal">null</span>, compilation);</span><br><span class="line">						&#125;);</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node_modules\webpack\lib\Compiler.js</span><br><span class="line">    	compile(callback) &#123;</span><br><span class="line">		<span class="keyword">const</span> params = <span class="keyword">this</span>.newCompilationParams();</span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeCompile.callAsync(params, err =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.hooks.compile.call(params);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">const</span> compilation = <span class="keyword">this</span>.newCompilation(params);</span><br><span class="line"></span><br><span class="line">&lt;!--  重要 这里开始编译 --&gt;</span><br><span class="line">			<span class="keyword">this</span>.hooks.make.callAsync(compilation, err =&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">				compilation.finish(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">					compilation.seal(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">						<span class="keyword">this</span>.hooks.afterCompile.callAsync(compilation, err =&gt; &#123;</span><br><span class="line">							<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line"></span><br><span class="line">							<span class="keyword">return</span> callback(<span class="literal">null</span>, compilation);</span><br><span class="line">						&#125;);</span><br><span class="line">					&#125;);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-SingleEntryPlugin-js-1"><a href="#webpack-lib-SingleEntryPlugin-js-1" class="headerlink" title="webpack\lib\SingleEntryPlugin.js"></a>webpack\lib\SingleEntryPlugin.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// this.hooks.make.callAsync 触发</span></span><br><span class="line">node_modules\webpack\lib\SingleEntryPlugin.js</span><br><span class="line">	compiler.hooks.make.tapAsync(</span><br><span class="line">			<span class="string">"SingleEntryPlugin"</span>,</span><br><span class="line">			(compilation, callback) =&gt; &#123;</span><br><span class="line">				<span class="keyword">const</span> &#123; entry, name, context &#125; = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">const</span> dep = SingleEntryPlugin.createDependency(entry, name);</span><br><span class="line">				compilation.addEntry(context, dep, name, callback);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-Compilation-js"><a href="#webpack-lib-Compilation-js" class="headerlink" title="webpack\lib\Compilation.js"></a>webpack\lib\Compilation.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">node_modules\webpack\lib\Compilation.js</span><br><span class="line">addEntry(context, entry, name, callback) &#123;</span><br><span class="line">		<span class="keyword">this</span>.hooks.addEntry.call(entry, name);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> slot = &#123;</span><br><span class="line">			name: name,</span><br><span class="line">			<span class="comment">// TODO webpack 5 remove `request`</span></span><br><span class="line">			request: <span class="literal">null</span>,</span><br><span class="line">			<span class="built_in">module</span>: <span class="literal">null</span></span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (entry <span class="keyword">instanceof</span> ModuleDependency) &#123;</span><br><span class="line">			slot.request = entry.request;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// TODO webpack 5: merge modules instead when multiple entry modules are supported</span></span><br><span class="line">		<span class="keyword">const</span> idx = <span class="keyword">this</span>._preparedEntrypoints.findIndex(<span class="function"><span class="params">slot</span> =&gt;</span> slot.name === name);</span><br><span class="line">		<span class="keyword">if</span> (idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// Overwrite existing entrypoint</span></span><br><span class="line">			<span class="keyword">this</span>._preparedEntrypoints[idx] = slot;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>._preparedEntrypoints.push(slot);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">this</span>._addModuleChain(</span><br><span class="line">			context,</span><br><span class="line">			entry,</span><br><span class="line">			<span class="built_in">module</span> =&gt; &#123;</span><br><span class="line">				<span class="keyword">this</span>.entries.push(<span class="built_in">module</span>);</span><br><span class="line">			&#125;,</span><br><span class="line">			(err, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (err) &#123;</span><br><span class="line">					<span class="keyword">this</span>.hooks.failedEntry.call(entry, name, err);</span><br><span class="line">					<span class="keyword">return</span> callback(err);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">module</span>) &#123;</span><br><span class="line">					slot.module = <span class="built_in">module</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">const</span> idx = <span class="keyword">this</span>._preparedEntrypoints.indexOf(slot);</span><br><span class="line">					<span class="keyword">if</span> (idx &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">						<span class="keyword">this</span>._preparedEntrypoints.splice(idx, <span class="number">1</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">this</span>.hooks.succeedEntry.call(entry, name, <span class="built_in">module</span>);</span><br><span class="line">				<span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-NormalModule-js"><a href="#webpack-lib-NormalModule-js" class="headerlink" title="webpack\lib\NormalModule.js"></a>webpack\lib\NormalModule.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">最终 走到 </span><br><span class="line">node_modules\webpack\lib\NormalModule.js</span><br><span class="line"></span><br><span class="line">build(options, compilation, resolver, fs, callback) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.doBuild(options, compilation, resolver, fs, err =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        	<span class="keyword">const</span> result = <span class="keyword">this</span>.parser.parse(</span><br><span class="line">	<span class="keyword">this</span>._ast || <span class="keyword">this</span>._source.source(),</span><br><span class="line">	&#123;</span><br><span class="line">		current: <span class="keyword">this</span>,</span><br><span class="line">		<span class="built_in">module</span>: <span class="keyword">this</span>,</span><br><span class="line">		compilation: compilation,</span><br><span class="line">		options: options</span><br><span class="line">	&#125;,</span><br><span class="line">	(err, result) =&gt; &#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			handleParseError(err);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			handleParseResult(result);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-NormalModuleFactory-js"><a href="#webpack-lib-NormalModuleFactory-js" class="headerlink" title="webpack\lib\NormalModuleFactory.js"></a>webpack\lib\NormalModuleFactory.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">在这个地方 设置 parser</span><br><span class="line">node_modules\webpack\lib\NormalModuleFactory.js</span><br><span class="line">	process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">const</span> type = settings.type;</span><br><span class="line">				<span class="keyword">const</span> resolveOptions = settings.resolve;</span><br><span class="line">				callback(<span class="literal">null</span>, &#123;</span><br><span class="line">					context: context,</span><br><span class="line">					request: loaders</span><br><span class="line">						.map(loaderToIdent)</span><br><span class="line">						.concat([resource])</span><br><span class="line">						.join(<span class="string">"!"</span>),</span><br><span class="line">					dependencies: data.dependencies,</span><br><span class="line">					userRequest,</span><br><span class="line">					rawRequest: request,</span><br><span class="line">					loaders,</span><br><span class="line">					resource,</span><br><span class="line">					matchResource,</span><br><span class="line">					resourceResolveData,</span><br><span class="line">					settings,</span><br><span class="line">					type,</span><br><span class="line">					parser: <span class="keyword">this</span>.getParser(type, settings.parser),</span><br><span class="line">					generator: <span class="keyword">this</span>.getGenerator(type, settings.generator),</span><br><span class="line">					resolveOptions</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-Compilation-js-递归-builder"><a href="#webpack-lib-Compilation-js-递归-builder" class="headerlink" title="webpack\lib\Compilation.js(递归 builder?)"></a>webpack\lib\Compilation.js(递归 builder?)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">   node_modules\webpack\lib\Compilation.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// &lt;!-- 这个地方进行递归 builder --&gt;</span></span><br><span class="line">   rebuildModule(<span class="built_in">module</span>, thisCallback) &#123;</span><br><span class="line">		<span class="keyword">let</span> callbackList = <span class="keyword">this</span>._rebuildingModules.get(<span class="built_in">module</span>);</span><br><span class="line">		<span class="keyword">if</span> (callbackList) &#123;</span><br><span class="line">			callbackList.push(thisCallback);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">this</span>._rebuildingModules.set(<span class="built_in">module</span>, (callbackList = [thisCallback]));</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> callback = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>._rebuildingModules.delete(<span class="built_in">module</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">const</span> cb <span class="keyword">of</span> callbackList) &#123;</span><br><span class="line">				cb(err);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">this</span>.hooks.rebuildModule.call(<span class="built_in">module</span>);</span><br><span class="line">		<span class="keyword">const</span> oldDependencies = <span class="built_in">module</span>.dependencies.slice();</span><br><span class="line">		<span class="keyword">const</span> oldVariables = <span class="built_in">module</span>.variables.slice();</span><br><span class="line">		<span class="keyword">const</span> oldBlocks = <span class="built_in">module</span>.blocks.slice();</span><br><span class="line">		<span class="built_in">module</span>.unbuild();</span><br><span class="line">		<span class="keyword">this</span>.buildModule(<span class="built_in">module</span>, <span class="literal">false</span>, <span class="built_in">module</span>, <span class="literal">null</span>, err =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (err) &#123;</span><br><span class="line">				<span class="keyword">this</span>.hooks.finishRebuildingModule.call(<span class="built_in">module</span>);</span><br><span class="line">				<span class="keyword">return</span> callback(err);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">this</span>.processModuleDependencies(<span class="built_in">module</span>, err =&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">				<span class="keyword">this</span>.removeReasonsOfDependencyBlock(<span class="built_in">module</span>, &#123;</span><br><span class="line">					dependencies: oldDependencies,</span><br><span class="line">					variables: oldVariables,</span><br><span class="line">					blocks: oldBlocks</span><br><span class="line">				&#125;);</span><br><span class="line">				<span class="keyword">this</span>.hooks.finishRebuildingModule.call(<span class="built_in">module</span>);</span><br><span class="line">				callback();</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-NormalModule-js-1"><a href="#webpack-lib-NormalModule-js-1" class="headerlink" title="webpack\lib\NormalModule.js"></a>webpack\lib\NormalModule.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">node_modules\webpack\lib\NormalModule.js</span><br><span class="line">&lt;!-- 所有的loader 都是在这里加载的 --&gt;</span><br><span class="line">在这里进行 js 的babel loader</span><br><span class="line">runLoaders(</span><br><span class="line">			&#123;</span><br><span class="line">				resource: <span class="keyword">this</span>.resource,</span><br><span class="line">				loaders: <span class="keyword">this</span>.loaders,</span><br><span class="line">				context: loaderContext,</span><br><span class="line">				readResource: fs.readFile.bind(fs)</span><br><span class="line">			&#125;,</span><br><span class="line">			(err, result) =&gt; &#123;</span><br><span class="line">				<span class="keyword">if</span> (result) &#123;</span><br><span class="line">					<span class="keyword">this</span>.buildInfo.cacheable = result.cacheable;</span><br><span class="line">					<span class="keyword">this</span>.buildInfo.fileDependencies = <span class="keyword">new</span> <span class="built_in">Set</span>(result.fileDependencies);</span><br><span class="line">					<span class="keyword">this</span>.buildInfo.contextDependencies = <span class="keyword">new</span> <span class="built_in">Set</span>(</span><br><span class="line">						result.contextDependencies</span><br><span class="line">					);</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>
<h2 id="待研究"><a href="#待研究" class="headerlink" title="待研究"></a>待研究</h2><ul>
<li>commander 这个npm包的研究</li>
<li>后期要对babel 做更多了解。</li>
<li>有空学习下 yield</li>
</ul>
<h2 id="parser"><a href="#parser" class="headerlink" title="parser"></a>parser</h2><h2 id="You-may-need-an-appropriate-loader-引发的问题"><a href="#You-may-need-an-appropriate-loader-引发的问题" class="headerlink" title="You may need an appropriate loader 引发的问题"></a>You may need an appropriate loader 引发的问题</h2><h3 id="可能有两种原因："><a href="#可能有两种原因：" class="headerlink" title="可能有两种原因："></a>可能有两种原因：</h3><p> 出现以上问题 可能有两种原因:</p>
<ul>
<li><p>确实没有处理js或css的loader<br>不过如果未定义js的loader，webpack 自身的 parse也不会报问题， 当js报下面错的时候，<br>大概率是由于 最新的es标准没有被解析，导致报错，而非loader问题，大概率是js的loader的配置问题。<br>如下是由于 babel-loader 没有配置解析最新的 可选链 语法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ERROR <span class="keyword">in</span> ./src/srctest.js <span class="number">3</span>:<span class="number">5</span></span><br><span class="line">Module parse failed: Unexpected token (<span class="number">3</span>:<span class="number">5</span>)</span><br><span class="line">You may need an appropriate loader to handle <span class="keyword">this</span> file type, currently no loaders are configured to process <span class="keyword">this</span> file. See https:<span class="comment">//webpack.js.org/concepts#loaders</span></span><br><span class="line">| <span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">|   <span class="keyword">const</span> dd = <span class="number">1299</span>;</span><br><span class="line">&gt;   dd?.u;</span><br><span class="line">|   <span class="built_in">console</span>.log(<span class="string">'chengduzhaolei------------------'</span>);</span><br><span class="line">| &#125;;</span><br><span class="line"> @ ./src/index.js <span class="number">7</span>:<span class="number">0</span><span class="number">-27</span> <span class="number">16</span>:<span class="number">0</span><span class="number">-2</span></span><br></pre></td></tr></table></figure>
<p>又比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> ERROR <span class="keyword">in</span> ./src/style.scss <span class="number">1</span>:<span class="number">11</span></span><br><span class="line">Module parse failed: Unexpected token (<span class="number">1</span>:<span class="number">11</span>)</span><br><span class="line">You may need an appropriate loader to handle <span class="keyword">this</span> file type, currently no loaders are configured to process <span class="keyword">this</span> file. See https:<span class="comment">//webpack.js.org/concepts#loaders</span></span><br><span class="line">&gt; body, html &#123;</span><br><span class="line">|   width: <span class="number">100</span>%;</span><br><span class="line">|   height: <span class="number">100</span>%;</span><br><span class="line"> @ ./src/index.js <span class="number">9</span>:<span class="number">0</span><span class="number">-22</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>第二种原因 就是上面说的 loader 的配置问题</li>
</ul>
<h3 id="被误解的报错来源"><a href="#被误解的报错来源" class="headerlink" title="被误解的报错来源"></a>被误解的报错来源</h3><p>起初，我们看到这个报错，比如上面的的 <code>ERROR in ./src/srctest.js 3:5</code> 的报错，<br>我们以为是 babel-loader 报出来的，<br>其实不然，其报错是 webpack 自身的解析器抛出。</p>
<h4 id="webpack的parse-js过程"><a href="#webpack的parse-js过程" class="headerlink" title="webpack的parse js过程"></a>webpack的parse js过程</h4><p>所有的js会被 fs 解析成字符串;<br>webpack 将解析好的字符串 传递给 babel loader ；<br>babel loader 中利用 babel-core 里面的 babel-parse ，加上配置；<br>将字符串解析(es6+转es5)为 ast 或 字符串；<br>webpack 拿到上述 ast或字符串，利用自己的 webpack parse () 解析一遍这个ast或字符串；<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\Parser.js</span></span><br><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">"acorn"</span>);</span><br><span class="line"><span class="keyword">const</span> acornParser = acorn.Parser;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">			ast = acornParser.parse(code, parserOptions);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">			<span class="comment">// js字符串 包含了高级语法 未被 babel loader 转为 es5，可能就会报错，</span></span><br><span class="line">			error = e;</span><br><span class="line">			threw = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (threw &amp;&amp; type === <span class="string">"auto"</span>) &#123;</span><br><span class="line">			parserOptions.sourceType = <span class="string">"script"</span>;</span><br><span class="line">			parserOptions.allowReturnOutsideFunction = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(parserOptions.onComment)) &#123;</span><br><span class="line">				parserOptions.onComment.length = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				ast = acornParser.parse(code, parserOptions);</span><br><span class="line">				threw = <span class="literal">false</span>;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">				threw = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></p>
<p>js字符串 包含了高级语法 未被 babel loader 转为 es5，可能就会报错，</p>
<p>所有的报错都会在这里被捕获：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\ModuleParseError.js</span></span><br><span class="line"><span class="keyword">constructor</span>(module, source, err, loaders) &#123;</span><br><span class="line">		<span class="keyword">let</span> message = <span class="string">"Module parse failed: "</span> + err.message;</span><br><span class="line">		<span class="keyword">let</span> loc = <span class="literal">undefined</span>;</span><br><span class="line">		<span class="keyword">if</span> (loaders.length &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">			message += <span class="string">`\nFile was processed with these loaders:<span class="subst">$&#123;loaders</span></span></span><br><span class="line"><span class="string"><span class="subst">				.map(loader =&gt; <span class="string">`\n * <span class="subst">$&#123;loader&#125;</span>`</span>)</span></span></span><br><span class="line"><span class="string"><span class="subst">				.join(<span class="string">""</span>)&#125;</span>`</span>;</span><br><span class="line">			message +=</span><br><span class="line">				<span class="string">"\nYou may need an additional loader to handle the result of these loaders."</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			message +=</span><br><span class="line">				<span class="string">"\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders"</span>;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="babel-loader和webpack的parse"><a href="#babel-loader和webpack的parse" class="headerlink" title="babel-loader和webpack的parse"></a>babel-loader和webpack的parse</h3><h4 id="二者区别与关系"><a href="#二者区别与关系" class="headerlink" title="二者区别与关系"></a>二者区别与关系</h4><p>babel-loader 使用的是 @babel/parser<br>webpack 使用的是 acorn</p>
<p>二者的parse 一脉相承 以及扩展的关系。<br><a href="https://zhuanlan.zhihu.com/p/358518402" target="_blank" rel="noopener">更多参考</a></p>
<h4 id="webpack会自己再次parse一次"><a href="#webpack会自己再次parse一次" class="headerlink" title="webpack会自己再次parse一次"></a>webpack会自己再次parse一次</h4><p>我们以为 webpack的parse是外部loader实现的，其实不然，<br>loader会自己parse一次，让后将parse后的字符串返回给 webpack，<br>由上面的《webpack的parse js过程》可知，<br>webpack 拿到这个字符串后，会再次解析一次，<br>这感觉解析重复了，不过好处是 webpack会检验解析的结果，如果不符合 js规范，就提前报错，<br>真正做到了js运行前 就把错误跑出来。</p>
<h3 id="js的世界是字符串"><a href="#js的世界是字符串" class="headerlink" title="js的世界是字符串"></a>js的世界是字符串</h3><p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。<br>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。<br>js 都是通过 fs 读写 字符串 然后通过 evel 或 new function  或 ast 语法树，编译成 js文件<br><a href="https://www.runoob.com/nodejs/nodejs-buffer.html" target="_blank" rel="noopener">参考</a></p>
<h2 id="exclude-的调用分析"><a href="#exclude-的调用分析" class="headerlink" title="exclude 的调用分析"></a>exclude 的调用分析</h2><h3 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h3><p>webpack 编译js时，执行 exclude 的判断时机和逻辑 <strong>不在loader上</strong>，<br>而是在 <code>webpack\lib\RuleSet.js</code>上，<br>webpack为每个文件 生成一个编译对象时，通过上面的 RuleSet.js 进行判断exclude, 设置此文件所有需要的loader，<br>如果满足了exclude，编译对象将不会有此loader，<br>没有此loader参与文件编译，那么该文件的编译，就根本不会去到loader里面。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">	exclude: <span class="regexp">/src.&#123;0,3&#125;srctest/</span>,</span><br><span class="line">	use: &#123;</span><br><span class="line">		loader: <span class="string">'babel-loader?cacheDirectory=true'</span>,</span><br><span class="line">		<span class="comment">// ...</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="RuleSet-js的执行分析"><a href="#RuleSet-js的执行分析" class="headerlink" title="RuleSet.js的执行分析"></a>RuleSet.js的执行分析</h3><p>其原理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\RuleSet.js</span></span><br><span class="line"><span class="keyword">static</span> normalizeCondition(condition) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!condition) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Expected condition but got falsy value"</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> condition === <span class="string">"string"</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="function"><span class="params">str</span> =&gt;</span> str.indexOf(condition) === <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> condition === <span class="string">"function"</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> condition;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (condition <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) &#123;</span><br><span class="line">			<span class="comment">// 这里 合成 exclude 的判断函数  condition 为 /src.&#123;0,3&#125;srctest/</span></span><br><span class="line">			<span class="keyword">return</span> condition.test.bind(condition);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(condition)) &#123;</span><br><span class="line">			<span class="keyword">const</span> items = condition.map(<span class="function"><span class="params">c</span> =&gt;</span> RuleSet.normalizeCondition(c));</span><br><span class="line">			<span class="keyword">return</span> orMatcher(items);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> andMatcher = <span class="function"><span class="params">items</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; items.length; i++) &#123;</span><br><span class="line">			<span class="comment">// /src.&#123;0,3&#125;srctest/.test('')</span></span><br><span class="line">			<span class="keyword">if</span> (!items[i](str)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>node_modules\webpack\lib\RuleSet.js的执行：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_run(data, rule, result) &#123;</span><br><span class="line">		<span class="comment">// test conditions</span></span><br><span class="line">		<span class="keyword">if</span> (rule.resource &amp;&amp; !data.resource) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (rule.realResource &amp;&amp; !data.realResource) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (rule.resourceQuery &amp;&amp; !data.resourceQuery) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (rule.compiler &amp;&amp; !data.compiler) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (rule.issuer &amp;&amp; !data.issuer) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="comment">// rule.resource(data.resource) 调用上面的 // /src.&#123;0,3&#125;srctest/.test('') if (!items[i](str)) return false;</span></span><br><span class="line">		<span class="comment">// return false 后 此loader 将不会被加入到 文件的loader上</span></span><br><span class="line">		<span class="keyword">if</span> (rule.resource &amp;&amp; !rule.resource(data.resource)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="调用过程"><a href="#调用过程" class="headerlink" title="调用过程"></a>调用过程</h3><p>流程如下：</p>
<h4 id="webpack-lib-Compilation-js-1"><a href="#webpack-lib-Compilation-js-1" class="headerlink" title="webpack\lib\Compilation.js"></a>webpack\lib\Compilation.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\Compilation.js</span></span><br><span class="line"><span class="keyword">this</span>.semaphore.acquire(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 这里create</span></span><br><span class="line">			moduleFactory.create(</span><br><span class="line">				&#123;</span><br><span class="line">					contextInfo: &#123;</span><br><span class="line">						issuer: <span class="string">""</span>,</span><br><span class="line">						compiler: <span class="keyword">this</span>.compiler.name</span><br><span class="line">					&#125;,</span><br><span class="line">					context: context,</span><br><span class="line">					dependencies: [dependency]</span><br><span class="line">				&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="webpack-lib-NormalModuleFactory-js-1"><a href="#webpack-lib-NormalModuleFactory-js-1" class="headerlink" title="webpack\lib\NormalModuleFactory.js"></a>webpack\lib\NormalModuleFactory.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\NormalModuleFactory.js</span></span><br><span class="line">create(data, callback) &#123;</span><br><span class="line">	<span class="comment">// 执行这个方法</span></span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeResolve.callAsync(</span><br><span class="line">			&#123;</span><br><span class="line">				contextInfo,</span><br><span class="line">				resolveOptions,</span><br><span class="line">				context,</span><br><span class="line">				request,</span><br><span class="line">				dependencies</span><br><span class="line">			&#125;,</span><br><span class="line">			(err, result) =&gt; &#123;</span><br><span class="line">				<span class="comment">// 执行这里</span></span><br><span class="line">				<span class="keyword">const</span> factory = <span class="keyword">this</span>.hooks.factory.call(<span class="literal">null</span>);</span><br><span class="line">				factory(result, (err, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">					callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// node_modules\webpack\lib\NormalModuleFactory.js</span></span><br><span class="line">create(data, callback) &#123;</span><br><span class="line">	<span class="comment">// 执行这个方法</span></span><br><span class="line">		<span class="keyword">this</span>.hooks.beforeResolve.callAsync(</span><br><span class="line">			&#123;</span><br><span class="line">				contextInfo,</span><br><span class="line">				resolveOptions,</span><br><span class="line">				context,</span><br><span class="line">				request,</span><br><span class="line">				dependencies</span><br><span class="line">			&#125;,</span><br><span class="line">			(err, result) =&gt; &#123;</span><br><span class="line">				<span class="comment">// 执行这里</span></span><br><span class="line">				<span class="keyword">const</span> factory = <span class="keyword">this</span>.hooks.factory.call(<span class="literal">null</span>);</span><br><span class="line">				factory(result, (err, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">					callback(<span class="literal">null</span>, <span class="built_in">module</span>);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同样这个js文件</span></span><br><span class="line">	<span class="keyword">this</span>.hooks.factory.tap(<span class="string">"NormalModuleFactory"</span>, () =&gt; <span class="function">(<span class="params">result, callback</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 执行这里</span></span><br><span class="line">			<span class="keyword">let</span> resolver = <span class="keyword">this</span>.hooks.resolver.call(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Ignored</span></span><br><span class="line">			<span class="keyword">if</span> (!resolver) <span class="keyword">return</span> callback();</span><br><span class="line"></span><br><span class="line">			resolver(result, (err, data) =&gt; &#123;</span><br><span class="line">				<span class="keyword">this</span>.hooks.afterResolve.callAsync(data, (err, result) =&gt; &#123;</span><br><span class="line">					<span class="comment">// ...</span></span><br><span class="line">					<span class="keyword">return</span> callback(<span class="literal">null</span>, createdModule);</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同样在这个页面</span></span><br><span class="line">	<span class="keyword">this</span>.hooks.resolver.tap(<span class="string">"NormalModuleFactory"</span>, () =&gt; <span class="function">(<span class="params">data, callback</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">const</span> contextInfo = data.contextInfo;</span><br><span class="line">			<span class="keyword">const</span> context = data.context;</span><br><span class="line">			<span class="keyword">const</span> request = data.request;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"></span><br><span class="line">			asyncLib.parallel(</span><br><span class="line">				[</span><br><span class="line">				<span class="comment">// ...</span></span><br><span class="line">				],</span><br><span class="line">				(err, results) =&gt; &#123;</span><br><span class="line">					<span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">				</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// 重点， exclude 的逻辑 是在这里处理的 ，这部分逻辑放到 《RuleSet.js的执行分析》</span></span><br><span class="line">					<span class="keyword">const</span> result = <span class="keyword">this</span>.ruleSet.exec(&#123;</span><br><span class="line">						resource: resourcePath,</span><br><span class="line">						realResource:</span><br><span class="line">							matchResource !== <span class="literal">undefined</span></span><br><span class="line">								? resource.replace(<span class="regexp">/\?.*/</span>, <span class="string">""</span>)</span><br><span class="line">								: resourcePath,</span><br><span class="line">						resourceQuery,</span><br><span class="line">						issuer: contextInfo.issuer,</span><br><span class="line">						compiler: contextInfo.compiler</span><br><span class="line">					&#125;);</span><br><span class="line">					<span class="keyword">const</span> useLoaders = [];</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">const</span> r <span class="keyword">of</span> result) &#123;</span><br><span class="line">						<span class="keyword">if</span> (r.type === <span class="string">"use"</span>) &#123;</span><br><span class="line">							<span class="comment">// ...</span></span><br><span class="line">								<span class="comment">// 这里</span></span><br><span class="line">								useLoaders.push(r.value);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					asyncLib.parallel(</span><br><span class="line">						[</span><br><span class="line">						<span class="comment">// ...</span></span><br><span class="line">							<span class="keyword">this</span>.resolveRequestArray.bind(</span><br><span class="line">								<span class="keyword">this</span>,</span><br><span class="line">								contextInfo,</span><br><span class="line">								<span class="keyword">this</span>.context,</span><br><span class="line">								useLoaders,</span><br><span class="line">								loaderResolver</span><br><span class="line">							),</span><br><span class="line">						<span class="comment">// ...</span></span><br><span class="line">						],</span><br><span class="line">						(err, results) =&gt; &#123;</span><br><span class="line">							</span><br><span class="line">						    loaders = results[<span class="number">0</span>].concat(loaders, results[<span class="number">1</span>], results[<span class="number">2</span>]);</span><br><span class="line">							</span><br><span class="line">							process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">								<span class="keyword">const</span> type = settings.type;</span><br><span class="line">								<span class="keyword">const</span> resolveOptions = settings.resolve;</span><br><span class="line">								callback(<span class="literal">null</span>, &#123;</span><br><span class="line">									context: context,</span><br><span class="line">									<span class="comment">// ...</span></span><br><span class="line">									<span class="comment">// 这里的loader 这里如果没有loader，说明后期这个文件处理的时候，就不会被loader处理</span></span><br><span class="line">									loaders,</span><br><span class="line">									resource,</span><br><span class="line">									matchResource,</span><br><span class="line">									resourceResolveData,</span><br><span class="line">									settings,</span><br><span class="line">									type,</span><br><span class="line">									parser: <span class="keyword">this</span>.getParser(type, settings.parser),</span><br><span class="line">									<span class="comment">// 。。。</span></span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;);</span><br><span class="line">						&#125;</span><br><span class="line">					);</span><br><span class="line">				&#125;</span><br><span class="line">			);</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>exclude 其实就是 loader 一个配置的一个侧面。<br>webpack的设计思想 应该是所有的 loader不处理webpack的配置逻辑；<br>因为这个配置逻辑属于webpack的业务逻辑；<br>babel-loader 本身只处理 纯粹的功能逻辑；<br>所以所有与配置相关的处理应该是 生成的一个js编译对象:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\NormalModuleFactory.js</span></span><br><span class="line">	process.nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">								<span class="keyword">const</span> type = settings.type;</span><br><span class="line">								<span class="keyword">const</span> resolveOptions = settings.resolve;</span><br><span class="line">								callback(<span class="literal">null</span>, &#123;</span><br><span class="line">									context: context,</span><br><span class="line">									request: loaders</span><br><span class="line">										.map(loaderToIdent)</span><br><span class="line">										.concat([resource])</span><br><span class="line">										.join(<span class="string">"!"</span>),</span><br><span class="line">									dependencies: data.dependencies,</span><br><span class="line">									userRequest,</span><br><span class="line">									rawRequest: request,</span><br><span class="line">									loaders,</span><br><span class="line">									resource,</span><br><span class="line">									matchResource,</span><br><span class="line">									resourceResolveData,</span><br><span class="line">									settings,</span><br><span class="line">									type,</span><br><span class="line">									parser: <span class="keyword">this</span>.getParser(type, settings.parser),</span><br><span class="line">									generator: <span class="keyword">this</span>.getGenerator(type, settings.generator),</span><br><span class="line">									resolveOptions</span><br><span class="line">								&#125;);</span><br><span class="line">							&#125;);</span><br></pre></td></tr></table></figure></p>
<p>exclude 只是一个点，以此类推，<br>以后配置相关的东西，只需要debug webpack的代码，而不用去debug loader 或 plugin 代码。</p>
<h2 id="两种设置babel配置的区别"><a href="#两种设置babel配置的区别" class="headerlink" title="两种设置babel配置的区别"></a>两种设置babel配置的区别</h2><h3 id="两种方式的差异"><a href="#两种方式的差异" class="headerlink" title="两种方式的差异"></a>两种方式的差异</h3><p>babel的配置有两种方式：<br>方式一 就是 babelrc<br>方式二 就是 option模式， 在 webpack.config.js 上：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">'babel-loader?cacheDirectory=true'</span>,</span><br><span class="line"><span class="comment">//   配置在这里</span></span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [</span><br><span class="line">            [</span><br><span class="line">              <span class="string">'@babel/preset-env'</span>,</span><br><span class="line">              &#123;</span><br><span class="line">                corejs: <span class="number">3</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">'@babel/preset-react'</span>,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<p><strong>这两种配置方式 在 webpack 4 的版本上具有差异：</strong><br>如果是 babelrc 的方式， 那么需要编译 node_modules 的包时， 无法结合 babelrc 的配置进行编译。<br>非 node_modules 目录的，也就是业务目录下的，不存在这个问题， webpack options 或 babelrc 两种方式都可 没有区别。</p>
<p>目前此问题 存在与 webpack 4， webpack 5 貌似不存在此问题。</p>
<h3 id="读取Babel-option的过程"><a href="#读取Babel-option的过程" class="headerlink" title="读取Babel option的过程"></a>读取Babel option的过程</h3><p>以下 皆以 webpack 4.6.3 为版本</p>
<h4 id="webpack-lib-NormalModule-js-2"><a href="#webpack-lib-NormalModule-js-2" class="headerlink" title="webpack\lib\NormalModule.js"></a>webpack\lib\NormalModule.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\webpack\lib\NormalModule.js</span></span><br><span class="line">	doBuild(options, compilation, resolver, fs, callback) &#123;</span><br><span class="line">		<span class="keyword">const</span> loaderContext = <span class="keyword">this</span>.createLoaderContext(</span><br><span class="line">			resolver,</span><br><span class="line">			options,</span><br><span class="line">			compilation,</span><br><span class="line">			fs</span><br><span class="line">		);</span><br><span class="line">    <span class="comment">// 这里</span></span><br><span class="line">		runLoaders(</span><br><span class="line">			&#123;</span><br><span class="line">				resource: <span class="keyword">this</span>.resource,</span><br><span class="line">				loaders: <span class="keyword">this</span>.loaders,</span><br><span class="line">				context: loaderContext,</span><br><span class="line">				readResource: fs.readFile.bind(fs)</span><br><span class="line">			&#125;,</span><br><span class="line">			(err, result) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">			&#125;)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="loader-runner-lib-LoaderRunner-js"><a href="#loader-runner-lib-LoaderRunner-js" class="headerlink" title="loader-runner\lib\LoaderRunner.js"></a>loader-runner\lib\LoaderRunner.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exports.runLoaders = <span class="function"><span class="keyword">function</span> <span class="title">runLoaders</span>(<span class="params">options, callback</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经过系列动作 跑到babel-loader\lib\index.js</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="babel-loader-lib-index-js"><a href="#babel-loader-lib-index-js" class="headerlink" title="babel-loader\lib\index.js"></a>babel-loader\lib\index.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\babel-loader\lib\index.js</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">		<span class="comment">// node_modules\@babel\core\lib\config\partial.js  的loadPartialConfig</span></span><br><span class="line">      loadPartialConfigAsync = babel.loadPartialConfig</span><br><span class="line">    &#125; = babel;</span><br><span class="line">    <span class="keyword">const</span> config = <span class="keyword">yield</span> loadPartialConfigAsync(injectCaller(programmaticOptions, <span class="keyword">this</span>.target));</span><br></pre></td></tr></table></figure>
<h4 id="babel-core-lib-config-partial-js"><a href="#babel-core-lib-config-partial-js" class="headerlink" title="@babel\core\lib\config\partial.js"></a>@babel\core\lib\config\partial.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\@babel\core\lib\config\partial.js</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> loadPartialConfig = _gensync()(<span class="function"><span class="keyword">function</span>* (<span class="params">opts</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">yield</span>* loadPrivatePartialConfig(opts);</span><br><span class="line">  <span class="keyword">if</span> (!result) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    options,</span><br><span class="line">    babelrc,</span><br><span class="line">    ignore,</span><br><span class="line">    config,</span><br><span class="line">    fileHandling,</span><br><span class="line">    files</span><br><span class="line">  &#125; = result;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PartialConfig(options, babelrc ? babelrc.filepath : <span class="literal">undefined</span>, ignore ? ignore.filepath : <span class="literal">undefined</span>, config ? config.filepath : <span class="literal">undefined</span>, fileHandling, files);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// node_modules\@babel\core\lib\config\partial.js</span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">loadPrivatePartialConfig</span>(<span class="params">inputOpts</span>) </span>&#123;</span><br><span class="line"><span class="comment">//   ....</span></span><br><span class="line"><span class="comment">// _configChain.buildRootChain 是 node_modules\@babel\core\lib\config\config-chain.js</span></span><br><span class="line">  <span class="keyword">const</span> configChain = <span class="keyword">yield</span>* (<span class="number">0</span>, _configChain.buildRootChain)(args, context);</span><br><span class="line">  <span class="keyword">if</span> (!configChain) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> merged = &#123;</span><br><span class="line">    assumptions: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  configChain.options.forEach(<span class="function"><span class="params">opts</span> =&gt;</span> &#123;</span><br><span class="line">    (<span class="number">0</span>, _util.mergeOptions)(merged, opts);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> options = <span class="built_in">Object</span>.assign(&#123;&#125;, merged, &#123;</span><br><span class="line">	<span class="comment">//   ...</span></span><br><span class="line">    plugins: configChain.plugins.map(<span class="function"><span class="params">descriptor</span> =&gt;</span> (<span class="number">0</span>, _item.createItemFromDescriptor)(descriptor)),</span><br><span class="line">    presets: configChain.presets.map(<span class="function"><span class="params">descriptor</span> =&gt;</span> (<span class="number">0</span>, _item.createItemFromDescriptor)(descriptor))</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    options,</span><br><span class="line">    context,</span><br><span class="line">    fileHandling: configChain.fileHandling,</span><br><span class="line">    ignore: configChain.ignore,</span><br><span class="line">    babelrc: configChain.babelrc,</span><br><span class="line">    config: configChain.config,</span><br><span class="line">    files: configChain.files</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="babel-core-lib-config-config-chain-js"><a href="#babel-core-lib-config-config-chain-js" class="headerlink" title="@babel\core\lib\config\config-chain.js"></a>@babel\core\lib\config\config-chain.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node_modules\@babel\core\lib\config\config-chain.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">buildRootChain</span>(<span class="params">opts, context</span>) </span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> ((babelrc === <span class="literal">true</span> || babelrc === <span class="literal">undefined</span>) &amp;&amp; <span class="keyword">typeof</span> context.filename === <span class="string">"string"</span>) &#123;</span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"><span class="comment">// 这一步决定了 babelrc 文件对 此要编译的js 文件 起作用 ，这是关键一步</span></span><br><span class="line">    <span class="keyword">if</span> (pkgData &amp;&amp; babelrcLoadEnabled(context, pkgData, babelrcRoots, babelrcRootsDirectory)) &#123;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> chain = mergeChain(mergeChain(mergeChain(emptyChain(), configFileChain), fileChain), programmaticChain);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    plugins: isIgnored ? [] : dedupDescriptors(chain.plugins),</span><br><span class="line">    presets: isIgnored ? [] : dedupDescriptors(chain.presets),</span><br><span class="line"><span class="comment">//   ...</span></span><br><span class="line">    babelrc: babelrcFile || <span class="literal">undefined</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">babelrcLoadEnabled</span>(<span class="params">context, pkgData, babelrcRoots, babelrcRootsDirectory</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (babelrcRoots === <span class="literal">undefined</span>) &#123;</span><br><span class="line">	<span class="comment">// pkgData.directories ：  ['D:\workplace\tstnpm\webpack-4.6\src', 'D:\workplace\tstnpm\webpack-4.6']</span></span><br><span class="line">	<span class="comment">// absoluteRoot ：  'D:\workplace\tstnpm\webpack-4.6'</span></span><br><span class="line">	<span class="comment">// 结果是true 所以业务代码是可以的</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果是 node_modules:</span></span><br><span class="line">	<span class="comment">// pkgData.directories ：  ['D:\workplace\tstnpm\webpack-4.6\node_modules\hz-npm-test\lib', 'D:\workplace\tstnpm\webpack-4.6\node_modules\hz-npm-test']</span></span><br><span class="line">	<span class="comment">// absoluteRoot ：  'D:\workplace\tstnpm\webpack-4.6'</span></span><br><span class="line">	<span class="comment">// 结果是false</span></span><br><span class="line">    <span class="keyword">return</span> pkgData.directories.indexOf(absoluteRoot) !== <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>由 《exclude 的调用分析  -  小结》 可知，所有的webpack 配置 是 webpack 自己处理的；<br>而 babel 的两种配置方式（webpack option 和 babelrc） , 除了下面的 关键字 option 对象是webpack的公共行为，<br>至于 webpack option 与 babelrc 的优先级 以及 node_modules  与 src/ 业务代码目录下 文件的babel 编译options 如何结合，<br>则不是webpack的事情，全部交给 babel自己处理 ，主要集中在 @babel\core 自身完成。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// @babel\core\lib\config\partial.js //partial 顾名思义 就是 优先的配置的意思</span></span><br><span class="line"><span class="comment">// @babel\core\lib\config\config-chain.js</span></span><br></pre></td></tr></table></figure></p>
<p>这两个都是典型的例子 ：<br>《exclude 的调用分析》 用于分析 webpack 自身的options 行为；<br>《两种设置babel配置的区别》 用于分析 loader 自身的options 处理行为；</p>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2023-12-25T11:16:20.315Z" itemprop="dateUpdated">2023-12-25 11:16:20</time>
</span><br>


        
        博客内容均为原创，转载注明出处，原文地址：<a href="/2022/03/23/webpack_one/" target="_blank" rel="external">https://yewills.github.io/2022/03/23/webpack_one/</a>
        
    </div>
    <footer>
        <a href="https://yewills.github.io">
            <img src="/img/avatar.jpg" alt="Mr.Yellow">
            Mr.Yellow
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack源码系列/">webpack源码系列</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2022/03/23/webpack_one/&title=《webpack源码系列(往)：开篇》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2022/03/23/webpack_one/&title=《webpack源码系列(往)：开篇》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2022/03/23/webpack_two/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">webpack源码系列(蹇)：loader</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2022/02/22/jstool/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">js工具函数</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#webpack源码学习策略"><span class="post-toc-number">1.</span> <span class="post-toc-text">webpack源码学习策略</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为什么要学源码"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">为什么要学源码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#需要了解的一览"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">需要了解的一览</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#学习历程"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">学习历程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-3-28以前"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">2022-3-28以前</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-3-28"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">2022-3-28</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-3-29"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">2022-3-29</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-3-31"><span class="post-toc-number">1.4.4.</span> <span class="post-toc-text">2022-3-31</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-1"><span class="post-toc-number">1.4.5.</span> <span class="post-toc-text">2022-4-1</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-2"><span class="post-toc-number">1.4.6.</span> <span class="post-toc-text">2022-4-2</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-6"><span class="post-toc-number">1.4.7.</span> <span class="post-toc-text">2022-4-6</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-7"><span class="post-toc-number">1.4.8.</span> <span class="post-toc-text">2022-4-7</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-11"><span class="post-toc-number">1.4.9.</span> <span class="post-toc-text">2022-4-11</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-12"><span class="post-toc-number">1.4.10.</span> <span class="post-toc-text">2022-4-12</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-13"><span class="post-toc-number">1.4.11.</span> <span class="post-toc-text">2022-4-13</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-14"><span class="post-toc-number">1.4.12.</span> <span class="post-toc-text">2022-4-14</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2022-4-20"><span class="post-toc-number">1.4.13.</span> <span class="post-toc-text">2022-4-20</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#当前要做"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">当前要做</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#demo"><span class="post-toc-number">2.</span> <span class="post-toc-text">demo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack源码库"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">webpack源码库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#version-debug-5-69-1-分支"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">version-debug-5.69.1 分支</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#参考"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">参考</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack调试库"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">webpack调试库</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三种webpack配置模式"><span class="post-toc-number">3.</span> <span class="post-toc-text">三种webpack配置模式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack入口"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">webpack入口</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack-dev-server-调试-待进一步整理"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">webpack-dev-server 调试 (待进一步整理)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#lib-webpack-js"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">lib\webpack.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-WebpackOptionsApply-js"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">webpack\lib\WebpackOptionsApply.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-EntryOptionPlugin-js"><span class="post-toc-number">3.2.3.</span> <span class="post-toc-text">webpack\lib\EntryOptionPlugin.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-SingleEntryPlugin-js"><span class="post-toc-number">3.2.4.</span> <span class="post-toc-text">webpack\lib\SingleEntryPlugin.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-dev-middleware-index-js"><span class="post-toc-number">3.2.5.</span> <span class="post-toc-text">webpack-dev-middleware\index.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Compiler-js"><span class="post-toc-number">3.2.6.</span> <span class="post-toc-text">webpack\lib\Compiler.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Watching-js"><span class="post-toc-number">3.2.7.</span> <span class="post-toc-text">webpack\lib\Watching.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Compiler-js-1"><span class="post-toc-number">3.2.8.</span> <span class="post-toc-text">webpack\lib\Compiler.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-SingleEntryPlugin-js-1"><span class="post-toc-number">3.2.9.</span> <span class="post-toc-text">webpack\lib\SingleEntryPlugin.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Compilation-js"><span class="post-toc-number">3.2.10.</span> <span class="post-toc-text">webpack\lib\Compilation.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-NormalModule-js"><span class="post-toc-number">3.2.11.</span> <span class="post-toc-text">webpack\lib\NormalModule.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-NormalModuleFactory-js"><span class="post-toc-number">3.2.12.</span> <span class="post-toc-text">webpack\lib\NormalModuleFactory.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Compilation-js-递归-builder"><span class="post-toc-number">3.2.13.</span> <span class="post-toc-text">webpack\lib\Compilation.js(递归 builder?)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-NormalModule-js-1"><span class="post-toc-number">3.2.14.</span> <span class="post-toc-text">webpack\lib\NormalModule.js</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#待研究"><span class="post-toc-number">4.</span> <span class="post-toc-text">待研究</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#parser"><span class="post-toc-number">5.</span> <span class="post-toc-text">parser</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#You-may-need-an-appropriate-loader-引发的问题"><span class="post-toc-number">6.</span> <span class="post-toc-text">You may need an appropriate loader 引发的问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#可能有两种原因："><span class="post-toc-number">6.1.</span> <span class="post-toc-text">可能有两种原因：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#被误解的报错来源"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">被误解的报错来源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack的parse-js过程"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">webpack的parse js过程</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel-loader和webpack的parse"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">babel-loader和webpack的parse</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#二者区别与关系"><span class="post-toc-number">6.3.1.</span> <span class="post-toc-text">二者区别与关系</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack会自己再次parse一次"><span class="post-toc-number">6.3.2.</span> <span class="post-toc-text">webpack会自己再次parse一次</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#js的世界是字符串"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">js的世界是字符串</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#exclude-的调用分析"><span class="post-toc-number">7.</span> <span class="post-toc-text">exclude 的调用分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原理分析"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">原理分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RuleSet-js的执行分析"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">RuleSet.js的执行分析</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#调用过程"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">调用过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-Compilation-js-1"><span class="post-toc-number">7.3.1.</span> <span class="post-toc-text">webpack\lib\Compilation.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-NormalModuleFactory-js-1"><span class="post-toc-number">7.3.2.</span> <span class="post-toc-text">webpack\lib\NormalModuleFactory.js</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小结"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">小结</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#两种设置babel配置的区别"><span class="post-toc-number">8.</span> <span class="post-toc-text">两种设置babel配置的区别</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#两种方式的差异"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">两种方式的差异</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#读取Babel-option的过程"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">读取Babel option的过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-lib-NormalModule-js-2"><span class="post-toc-number">8.2.1.</span> <span class="post-toc-text">webpack\lib\NormalModule.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#loader-runner-lib-LoaderRunner-js"><span class="post-toc-number">8.2.2.</span> <span class="post-toc-text">loader-runner\lib\LoaderRunner.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#babel-loader-lib-index-js"><span class="post-toc-number">8.2.3.</span> <span class="post-toc-text">babel-loader\lib\index.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#babel-core-lib-config-partial-js"><span class="post-toc-number">8.2.4.</span> <span class="post-toc-text">@babel\core\lib\config\partial.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#babel-core-lib-config-config-chain-js"><span class="post-toc-number">8.2.5.</span> <span class="post-toc-text">@babel\core\lib\config\config-chain.js</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小结-1"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">小结</span></a></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

        <footer class="footer">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Mr.Yellow &copy; 2017 - 2023
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2022/03/23/webpack_one/&title=《webpack源码系列(往)：开篇》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2022/03/23/webpack_one/&title=《webpack源码系列(往)：开篇》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3ay3bCMAwFQP7/p+m2XRDuldP2YE9WHMjDk4WQZD0e8fG8PL6f8+r863u++ubmAwMD42MZ+RLv+qb9fL02DAyMcxivItj1OdfnR4+/DNDJ2jAwMDCul5gsIk8ZMTAwMO4NuHnxmSD/7X8DAwPjoxjt7fLFJYtYoWJgYJzAyLvuf//5V/Y3MDAwPorxLI/22mRZszv/eAoGBsbWjLbpPxuhyAGz9WBgYJzAaJv7s3K0vTY5M3rfGBgYWzDyRc+2BJKQPRspe/m/gYGBsRGjFsfbmXeF1Kj1hoGBsTVjvYBcKWvbxLFIPTEwMDZitM33tomWhNGVBLHeScDAwNiIkZSg7WBEPvJVp6EYGBgHMFaKyfbXtjSN2nMYGBhbM+5qvbWl7CzURi8CAwNjO0aeriVJYZJK5i+uaAJiYGBszbi3KTZ7TbOC9s3MCAYGxkaMdlQrj2+zFDAvcTEwMM5htHNW7RZjG3DzEQ0MDIzTGLNiNQ+pK4MUxdYpBgbGAYxZsGuHM1YC8RsMBgbGAYyVptts+3Pl6RgYGGcy8k3EvLlfj6IulNMYGBi7Mp7lsTLnMLs2omJgYGzNmG0MzG46g83STQwMjP0YSZDNhyRmJesNe60YGBgHMNrAlw+NJeVuW8RiYGBg5Clafoc2xayTUQwMDIxyoSvLatNQDAyMcxhJETvbpJwVrvUABwYGxtaMWenYlrJ502023oqBgbEp4wvAZBkG1Onl4QAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/plugins/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/plugins/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/plugins/MathJax.js"></script>
<script type="text/javascript" src="/js/plugins/TeX-AMS-MML_HTMLorMML.js"></script>
<script type="text/javascript" src="/js/plugins/MathMenu.js"></script>
<script type="text/javascript" src="/js/plugins/MathZoom.js"></script>

<script type="text/javascript" src="/js/plugins/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.9"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.9"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src=""></script>







    
</body>
</html>
