<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>linux笔记(坎) | Mr.Yellow.Wills</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="linux">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.3.9">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Mr.Yellow</h5>
          <a href="mailto:601661706@qq.com" title="601661706@qq.com" class="mail">
            
              <span>6</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>0</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/YeWills/YeWills.github.io/tree/blog_code" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>linux笔记(坎)</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">linux笔记(坎)</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-06-16T00:00:00.000Z" itemprop="datePublished" class="page-time">
  2021-06-16
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/">linux</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-linux_five"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">linux笔记(坎)</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-06-16 00:00:00" datetime="2021-06-16T00:00:00.000Z"  itemprop="datePublished">2021-06-16</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/linux/">linux</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h2 id="Nginx-服务器"><a href="#Nginx-服务器" class="headerlink" title="Nginx 服务器"></a>Nginx 服务器</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>关于 Nginx，<a href="https://www.cnblogs.com/wcwnina/p/8728391.html" target="_blank" rel="noopener">参考博客</a><br>摘录博客部分内容：<br>反向代理：<br>反向代理，”它代理的是服务端，代服务端接收请求”，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/ng1.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/ng1.png" alt title class></a>
                <p></p>
            </figure><br>正向代理：<br>正向代理最大的特点是客户端非常明确要访问的服务器地址；服务器只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；正向代理模式屏蔽或者隐藏了真实客户端信息。<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/ng2.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/ng2.png" alt title class></a>
                <p></p>
            </figure></p>
<h4 id="apache、nginx、IIS"><a href="#apache、nginx、IIS" class="headerlink" title="apache、nginx、IIS"></a>apache、nginx、IIS</h4><p>高性能、轻量级、功能丰富、配置简单。用c语言写的；<br>2004年发布第一版<br>apache、nginx、IIS 并称 服务器三巨头<br>apache 阻塞型、同步多进程。nginx 异步、非阻塞、事件驱动；</p>
<p>下图时服务器排名：<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/ng3.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/ng3.png" alt title class></a>
                <p></p>
            </figure></p>
<h3 id="安装和使用nginx"><a href="#安装和使用nginx" class="headerlink" title="安装和使用nginx"></a>安装和使用nginx</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release  红帽系列额外包，nginx安装依赖此包</span><br><span class="line">yum install nginx</span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure>
<h4 id="两种启动方式"><a href="#两种启动方式" class="headerlink" title="两种启动方式"></a>两种启动方式</h4><p>方式一：<br>直接命令行 输入 nginx；<br>方式二：<br><code>systemctl start nginx</code></p>
<p>启动后访问，这里会出现centos页面，此页面是nginx驱动的页面，<br>可在<code>/usr/share/nginx/html/index.html</code>中配置<br><a href="http://192.168.1.109/" target="_blank" rel="noopener">http://192.168.1.109/</a><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/ng4.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/ng4.png" alt title class></a>
                <p></p>
            </figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -ql nginx  查看nginx相关配置</span><br><span class="line">/etc/nginx/nginx.conf  #主配置文件</span><br><span class="line">/usr/share/nginx/html/index.html  #上面http://192.168.1.109/浏览器上显示的页面</span><br><span class="line">/usr/lib/systemd/system/nginx.service  #决定了 可使用systemctl start nginx 启动</span><br><span class="line">/usr/sbin/nginx #决定了 可使用nginx 直接启动</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="启动nginx失败的解决方法"><a href="#启动nginx失败的解决方法" class="headerlink" title="启动nginx失败的解决方法"></a>启动nginx失败的解决方法</h4><p>当然了，你也可能启动nginx失败，可能的原因是，你的机器同时启动了apache，<br>apache和nginx都是监听80端口，因此失败。</p>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/ng5.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/ng5.png" alt title class></a>
                <p></p>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#解决之道，可关闭 apache，再次启动nginx：</span><br><span class="line">systemctl stop httpd</span><br><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure>
<h3 id="nginx语法"><a href="#nginx语法" class="headerlink" title="nginx语法"></a>nginx语法</h3><p><a href="http://nginx.org/en/docs/" target="_blank" rel="noopener">官网文档</a></p>
<h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><p>没有用花括号包含的，就是全局变量，比如下面就是全局变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user nginx;  </span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br></pre></td></tr></table></figure></p>
<h4 id="花括号-局部变量-和-区块"><a href="#花括号-局部变量-和-区块" class="headerlink" title="花括号(局部变量 和 区块)"></a>花括号(局部变量 和 区块)</h4><p>如下，events的相关区块信息都定义在花括号内，花括号内定义的变量是局部变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="定义一个名字"><a href="#定义一个名字" class="headerlink" title="定义一个名字"></a>定义一个名字</h4><p>如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  #log_format定义了日志的格式以 右侧一长串字符串格式形式，</span><br><span class="line">  #因为access_log也要用到这串长字符串，因此log_format给字符串定义了一个名字 main</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;   #main代表了上面的长字符串</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="include-导入"><a href="#include-导入" class="headerlink" title="include 导入"></a>include 导入</h4><p>相当于import，在配置中导入其他配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include /etc/nginx/conf.d/*.conf;</span><br></pre></td></tr></table></figure></p>
<h4 id="以分号结尾"><a href="#以分号结尾" class="headerlink" title="以分号结尾"></a>以分号结尾</h4><p>代码行以分号结尾，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_connections 1024;</span><br></pre></td></tr></table></figure></p>
<h3 id="nginx-其他知识介绍"><a href="#nginx-其他知识介绍" class="headerlink" title="nginx 其他知识介绍"></a>nginx 其他知识介绍</h3><h4 id="server-虚拟主机-和-端口服务等"><a href="#server-虚拟主机-和-端口服务等" class="headerlink" title="server (虚拟主机 和 端口服务等)"></a>server (虚拟主机 和 端口服务等)</h4><p>nginx 的 server 相当于 apache的虚拟主机：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">      listen       80 default_server;</span><br><span class="line">      listen       [::]:80 default_server;</span><br><span class="line">      server_name  _;</span><br><span class="line">      root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">      # Load configuration files for the default server block.</span><br><span class="line">      include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">      location / &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      error_page 404 /404.html;</span><br><span class="line">      location = /404.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      error_page 500 502 503 504 /50x.html;</span><br><span class="line">      location = /50x.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="全局变量含义介绍"><a href="#全局变量含义介绍" class="headerlink" title="全局变量含义介绍"></a>全局变量含义介绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user nginx;  #说明用户是nginx</span><br><span class="line">worker_processes auto; #nginx 的cpu 核心数设置，单核或多核 ，可设置值为 auto ，也可为 1，2，3等</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123; #nginx是基于事件的</span><br><span class="line">    worker_connections 1024; #对应上面的worker_processes的，每个work进程可以有多少个连接</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;&#125; #这里配置一些http协议</span><br></pre></td></tr></table></figure>
<h4 id="nginx主配置文件"><a href="#nginx主配置文件" class="headerlink" title="nginx主配置文件"></a>nginx主配置文件</h4><p>以下是主配置文件，这里注释一些上面没有解释到的内容，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx]# cat /etc/nginx/nginx.conf</span><br><span class="line"># For more information on configuration, see:</span><br><span class="line">#   * Official English Documentation: http://nginx.org/en/docs/</span><br><span class="line">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;  #nginx默认使用80端口,这是针对 ipv4</span><br><span class="line">        listen       [::]:80 default_server; #nginx默认使用80端口,这是针对 ipv6</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.   #nginx定义https</span><br><span class="line">#</span><br><span class="line">#    server &#123;</span><br><span class="line">#        listen       443 ssl http2 default_server;</span><br><span class="line">#        listen       [::]:443 ssl http2 default_server;</span><br><span class="line">#        server_name  _;</span><br><span class="line">#        root         /usr/share/nginx/html;</span><br><span class="line">#</span><br><span class="line">#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;</span><br><span class="line">#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;</span><br><span class="line">#        ssl_session_cache shared:SSL:1m;</span><br><span class="line">#        ssl_session_timeout  10m;</span><br><span class="line">#        ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">#        ssl_prefer_server_ciphers on;</span><br><span class="line">#</span><br><span class="line">#        # Load configuration files for the default server block.</span><br><span class="line">#        include /etc/nginx/default.d/*.conf;</span><br><span class="line">#</span><br><span class="line">#        location / &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 404 /404.html;</span><br><span class="line">#        location = /404.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#</span><br><span class="line">#        error_page 500 502 503 504 /50x.html;</span><br><span class="line">#        location = /50x.html &#123;</span><br><span class="line">#        &#125;</span><br><span class="line">#    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="配置nginx为反向代理，设置https"><a href="#配置nginx为反向代理，设置https" class="headerlink" title="配置nginx为反向代理，设置https"></a>配置nginx为反向代理，设置https</h2><h3 id="配置https方案"><a href="#配置https方案" class="headerlink" title="配置https方案"></a>配置https方案</h3><p>本例展示 nginx 反向代理 apache tomcat的Jenkins 服务器。</p>
<p>因为 nginx apache 共同监听了 80 和 443端口，<br>因此第一步 修改 apache 的80 443端口；<br>过程中，为了方便理解，首先不急于直接配置https，而是先配置 nginx http 的方向代理</p>
<p>然后 再配置 nginx https 的反向代理；</p>
<h3 id="修改apache"><a href="#修改apache" class="headerlink" title="修改apache"></a>修改apache</h3><h4 id="修改apache-80-443-端口"><a href="#修改apache-80-443-端口" class="headerlink" title="修改apache 80 443 端口"></a>修改apache 80 443 端口</h4><ul>
<li>修改apache 80 443 端口<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">#将原来的</span><br><span class="line">#Listen 80</span><br><span class="line">#改为</span><br><span class="line">#Listen 7080 http</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> vim /etc/httpd/conf.d/ssl.conf</span><br><span class="line">#将原来的</span><br><span class="line">#Listen 443 https</span><br><span class="line">#改为</span><br><span class="line">#Listen 7443 https</span><br><span class="line"></span><br><span class="line">将原来的</span><br><span class="line">#&lt;VirtualHost _default_:443&gt;</span><br><span class="line">#改为</span><br><span class="line">#&lt;VirtualHost _default_:7443&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="重启apache报错"><a href="#重启apache报错" class="headerlink" title="重启apache报错"></a>重启apache报错</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart httpd</span><br><span class="line">#systemctl status httpd.service #执行此命令查看详细原因</span><br><span class="line">Job for httpd.service failed because the control process exited with error code. See &quot;systemctl status httpd.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">[root@localhost ~]# systemctl status httpd.service</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Wed 2021-06-16 11:53:40 EDT; 32s ago</span><br><span class="line">     Docs: man:httpd(8)</span><br><span class="line">           man:apachectl(8)</span><br><span class="line">  Process: 2383 ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND (code=exited, status=1/FAILURE)</span><br><span class="line"> Main PID: 2383 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Starting The Apache HTTP Se...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: AH00558: httpd: Could not ...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: (13)Permission denied: AH0...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: (13)Permission denied: AH0...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: no listening sockets avail...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: AH00015: Unable to open logs</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: httpd.service: main process...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Failed to start The Apache ...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Unit httpd.service entered ...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: httpd.service failed.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full. #有些行被折叠了，命令后加参数 -l 查看所有</span><br><span class="line">[root@localhost ~]# systemctl status httpd.service -l</span><br><span class="line">● httpd.service - The Apache HTTP Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since Wed 2021-06-16 11:53:40 EDT; 1min 0s ago</span><br><span class="line">     Docs: man:httpd(8)</span><br><span class="line">           man:apachectl(8)</span><br><span class="line">  Process: 2383 ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND (code=exited, status=1/FAILURE)</span><br><span class="line"> Main PID: 2383 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Starting The Apache HTTP Server...</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using localhost.localdomain. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">#发现是7080端口限制，是 SElinux 的问题</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: (13)Permission denied: AH00072: make_sock: could not bind to address [::]:7080  </span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: (13)Permission denied: AH00072: make_sock: could not bind to address 0.0.0.0:7080</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: no listening sockets available, shutting down</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain httpd[2383]: AH00015: Unable to open logs</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: httpd.service: main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Failed to start The Apache HTTP Server.</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: Unit httpd.service entered failed state.</span><br><span class="line">Jun 16 11:53:40 localhost.localdomain systemd[1]: httpd.service failed.</span><br></pre></td></tr></table></figure>
<h4 id="SElinux-增加端口7080-7443"><a href="#SElinux-增加端口7080-7443" class="headerlink" title="SElinux 增加端口7080 7443"></a>SElinux 增加端口7080 7443</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# semanage port -l | grep http #查看SElinux与 http相关的端口</span><br><span class="line">http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010</span><br><span class="line">http_cache_port_t              udp      3130</span><br><span class="line">http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, 9000  #看这里，缺少了 7443 7080</span><br><span class="line">pegasus_http_port_t            tcp      5988</span><br><span class="line">pegasus_https_port_t           tcp      5989</span><br><span class="line">[root@localhost ~]# semanage port -a -t http_port_t -p tcp 7080   #semanage给SElinux增加端口  http_port_t对应上面的http_port_t， 增加 7080端口</span><br><span class="line">[root@localhost ~]# semanage port -a -t http_port_t -p tcp 7443</span><br><span class="line">[root@localhost ~]# semanage port -l | grep http</span><br><span class="line">http_cache_port_t              tcp      8080, 8118, 8123, 10001-10010</span><br><span class="line">http_cache_port_t              udp      3130</span><br><span class="line">http_port_t                    tcp      7443, 7080, 80, 81, 443, 488, 8008, 8009, 8443, 9000</span><br><span class="line">pegasus_http_port_t            tcp      5988</span><br><span class="line">pegasus_https_port_t           tcp      5989</span><br></pre></td></tr></table></figure>
<h4 id="防火墙-增加端口7080-7443"><a href="#防火墙-增加端口7080-7443" class="headerlink" title="防火墙 增加端口7080 7443"></a>防火墙 增加端口7080 7443</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --list-ports</span><br><span class="line">443/tcp 80/tcp 3306/tcp 8080/tcp</span><br><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=7080/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=7443/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --list-ports</span><br><span class="line">443/tcp 80/tcp 3306/tcp 8080/tcp 7080/tcp 7443/tcp</span><br></pre></td></tr></table></figure>
<h4 id="访问网站"><a href="#访问网站" class="headerlink" title="访问网站"></a>访问网站</h4><p><a href="http://192.168.1.109:7080/" target="_blank" rel="noopener">http://192.168.1.109:7080/</a><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/apa1.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/apa1.png" alt title class></a>
                <p></p>
            </figure><br><a href="https://192.168.1.109:7443/" target="_blank" rel="noopener">https://192.168.1.109:7443/</a><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/apa2.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/apa2.png" alt title class></a>
                <p></p>
            </figure></p>
<h4 id="访问失败的解决方法"><a href="#访问失败的解决方法" class="headerlink" title="访问失败的解决方法"></a>访问失败的解决方法</h4><p>上面设置后，也可能失败，那就把nginx关闭，再先把 防火墙 和 SElinux 都关闭，然后重新设置一次：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop 立即停止nginx服务</span><br><span class="line">setenforce 0</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置完后，立即执行：</span><br><span class="line">systemctl restart httpd</span><br><span class="line">#然后再打开 防火墙 和 sss ，</span><br><span class="line">#再次访问，结果都可以了</span><br><span class="line">setenforce 1</span><br><span class="line">systemctl start firewalld</span><br></pre></td></tr></table></figure></p>
<h3 id="配置nginx为http-反向代理"><a href="#配置nginx为http-反向代理" class="headerlink" title="配置nginx为http 反向代理"></a>配置nginx为http 反向代理</h3><h4 id="配置nginx的http"><a href="#配置nginx的http" class="headerlink" title="配置nginx的http"></a>配置nginx的http</h4><p>/etc/nginx/nginx.conf  是nginx主配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx]# nginx  #启动nginx</span><br><span class="line">[root@localhost nginx]# systemctl start tomcat #启动jenkins</span><br></pre></td></tr></table></figure>
<p>启动tomcat是为了后面 nginx配置转发到tomcat上的Jenkins时用；</p>
<p>页面即可访问：<br><a href="http://192.168.1.109/" target="_blank" rel="noopener">http://192.168.1.109/</a>   nginx驱动页面<br><a href="http://192.168.1.109:8080/jenkins/" target="_blank" rel="noopener">http://192.168.1.109:8080/jenkins/</a>  jenkins驱动页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf </span><br><span class="line"></span><br><span class="line">#在http区块内，增加如下代码：</span><br><span class="line"></span><br><span class="line">  upstream backend-apache &#123;   #upstream上游的意思，定义apache服务器后端， 注意定义名字不要用下斜杠，</span><br><span class="line">  #可能会有问题，也可能没有，backend_apache 这样是不好的</span><br><span class="line">      server 127.0.0.1:7080;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> upstream backend-jenkins &#123; #定义jenkins服务器后端</span><br><span class="line">        server 127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">#修改http区块内的server区块，修改如下代码：</span><br><span class="line">  server &#123;</span><br><span class="line">            server_name  www.linuxcoreaqq.com linuxcoreapp.com; #设置域名 ，使用空格隔开 可设置多个域名</span><br><span class="line">            location / &#123;  #location是域名后接的path，/ 代表 www.linuxcoreaqq.com 将重定向转接到 apache服务器</span><br><span class="line">                    proxy_pass http://backend-apache;   #proxy_pass proxy是代理 pass是转接，</span><br><span class="line">                    #代理到上面定义的backend_apache apache服务器</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            location /jenkins &#123;   #/jenkins 代表 www.linuxcoreaqq.com/jenkins 将重定向转接到jenkins服务器</span><br><span class="line">                    proxy_pass http://backend-jenkins;   #代理到上面定义的backend_jenkins  jenkins服务器</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="解决棘手的配置重载报错"><a href="#解决棘手的配置重载报错" class="headerlink" title="解决棘手的配置重载报错"></a>解决棘手的配置重载报错</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# nginx -s reload #报错</span><br><span class="line">nginx: [error] open() &quot;/run/nginx.pid&quot; failed (2: No such file or directory)</span><br><span class="line">[root@localhost ~]# systemctl restart nginx #也失败报错</span><br><span class="line">[root@localhost ~]# nginx 报错</span><br><span class="line">nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br></pre></td></tr></table></figure>
<p>其实以上问题，都是一个原因，就是80端口被占用，因此当务之急就是杀掉所有 80端口占用的程序，包括 nginx自己；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -anp |grep 80  #查看所有占用80端口的pid进程</span><br><span class="line">kill -9 1796 1797  kill -9 #是固定写法，后面跟pid</span><br><span class="line">nginx  #成功了，不报错了</span><br><span class="line">nginx -s reload  #成功了，不报错了</span><br></pre></td></tr></table></figure></p>
<h4 id="配置nginx的http成功"><a href="#配置nginx的http成功" class="headerlink" title="配置nginx的http成功"></a>配置nginx的http成功</h4><p>127.0.0.1:7080<br>如上面nginx代码，</p>
<ul>
<li>就是 当访问 <a href="http://192.168.1.109/" target="_blank" rel="noopener">http://192.168.1.109/</a> 时，将请求转发到 <a href="http://127.0.0.1:7080" target="_blank" rel="noopener">http://127.0.0.1:7080</a>  上(apache服务器)；</li>
<li>就是 当访问 <a href="http://192.168.1.109/jenkins" target="_blank" rel="noopener">http://192.168.1.109/jenkins</a> 时，将请求转发到 <a href="http://127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a>  上(tomcat服务器)；</li>
</ul>
<p>现在访问如下，说明成功了：<br><a href="http://192.168.1.109/" target="_blank" rel="noopener">http://192.168.1.109/</a><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/proxy1.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/proxy1.png" alt title class></a>
                <p></p>
            </figure><br><a href="http://192.168.1.109/jenkins" target="_blank" rel="noopener">http://192.168.1.109/jenkins</a><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/proxy2.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/proxy2.png" alt title class></a>
                <p></p>
            </figure></p>
<p>客户机配置好 host后，也可通过域名访问，如<br><a href="http://www.linuxcoreaqq.com/jenkins" target="_blank" rel="noopener">http://www.linuxcoreaqq.com/jenkins</a></p>
<h3 id="nginx-配置https-反向代理"><a href="#nginx-配置https-反向代理" class="headerlink" title="nginx 配置https 反向代理"></a>nginx 配置https 反向代理</h3><p>将所有的http请求，重定向到https请求；</p>
<h4 id="生成-证书和私钥"><a href="#生成-证书和私钥" class="headerlink" title="生成 证书和私钥"></a>生成 证书和私钥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls /etc/httpd/pki/  #在配置apache https时，我们生成过两个公钥 私钥，以此配置nginx；</span><br><span class="line">server.crt  server.csr  server.key</span><br><span class="line">[root@localhost ~]# cd /etc/nginx/</span><br><span class="line">[root@localhost nginx]# mkdir pki</span><br><span class="line">[root@localhost nginx]# cd pki</span><br><span class="line">[root@localhost pki]# cp /etc/httpd/pki/server.crt /etc/httpd/pki/server.key .   #将apache配置的公钥 私钥放到 此目录</span><br><span class="line">[root@localhost pki]# ls</span><br><span class="line">server.crt  server.key</span><br><span class="line">[root@localhost pki]# pwd</span><br><span class="line">/etc/nginx/pki</span><br></pre></td></tr></table></figure>
<h4 id="配置-443端口"><a href="#配置-443端口" class="headerlink" title="配置 443端口"></a>配置 443端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost pki]# vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p>https 在主配置文件中已经配置好，只是注释了，我们要做的就是放开注释；<br>然后做以下修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_certificate &quot;/etc/nginx/pki/server.crt&quot;;</span><br><span class="line">ssl_certificate_key &quot;/etc/nginx/pki/server.key&quot;;</span><br></pre></td></tr></table></figure></p>
<h4 id="在80-端口-区块中定义："><a href="#在80-端口-区块中定义：" class="headerlink" title="在80 端口 区块中定义："></a>在80 端口 区块中定义：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#301重定向  $host$request_uri 是nginx的两个变量，分别代表 主机地址 和url后的路径</span><br><span class="line">return 301 https://$host$request_uri;</span><br></pre></td></tr></table></figure>
<p>并将下面配置 从 80 区块 移动至 443端口区块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">            proxy_pass http://backend-apache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /jenkins &#123;</span><br><span class="line">            proxy_pass http://backend-jenkins;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="完整的配置"><a href="#完整的配置" class="headerlink" title="完整的配置"></a>完整的配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost pki]# cat /etc/nginx/nginx.conf</span><br><span class="line"># For more information on configuration, see:</span><br><span class="line">#   * Official English Documentation: http://nginx.org/en/docs/</span><br><span class="line">#   * Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span class="line"></span><br><span class="line">user nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 2048;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">  upstream backend-apache &#123;</span><br><span class="line">      server 127.0.0.1:7080;</span><br><span class="line">  &#125;</span><br><span class="line"> upstream backend-jenkins &#123;</span><br><span class="line">        server 127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server;</span><br><span class="line">        server_name  www.linuxcoreaqq.com linuxcoreapp.com;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        #location / &#123;</span><br><span class="line">       # &#125;</span><br><span class="line"></span><br><span class="line">       return 301 https://$host$request_uri;</span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># Settings for a TLS enabled server.</span><br><span class="line">#</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443 ssl http2 default_server;</span><br><span class="line">        listen       [::]:443 ssl http2 default_server;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        ssl_certificate &quot;/etc/nginx/pki/server.crt&quot;;</span><br><span class="line">        ssl_certificate_key &quot;/etc/nginx/pki/server.key&quot;;</span><br><span class="line">        ssl_session_cache shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  10m;</span><br><span class="line">        ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">         location / &#123;</span><br><span class="line">                proxy_pass http://backend-apache;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /jenkins &#123;</span><br><span class="line">                proxy_pass http://backend-jenkins;</span><br><span class="line">        &#125;</span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="浏览器访问http-会-自动转-https"><a href="#浏览器访问http-会-自动转-https" class="headerlink" title="浏览器访问http 会 自动转 https"></a>浏览器访问http 会 自动转 https</h4><p><a href="http://www.linuxcoreaqq.com/jenkins" target="_blank" rel="noopener">http://www.linuxcoreaqq.com/jenkins</a> 将被重定向到https：<br><a href="https://www.linuxcoreaqq.com/jenkins" target="_blank" rel="noopener">https://www.linuxcoreaqq.com/jenkins</a></p>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/https.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/https.png" alt title class></a>
                <p></p>
            </figure>
<h3 id="过程分析"><a href="#过程分析" class="headerlink" title="过程分析"></a>过程分析</h3><h4 id="过程描述"><a href="#过程描述" class="headerlink" title="过程描述"></a>过程描述</h4><p>上面首先利用 nginx 代理了所有的http请求，301重定向到 https；<br>从此 客户端 发往服务端的请求 都是https；<br>nginx 监听 443请求，接收客户端的https请求；<br>然后将客户端以http形式转发给 对应的服务端(Jenkins 或 apache)</p>
<h4 id="nginx-拦截了所有-客户端http请求，并响应301"><a href="#nginx-拦截了所有-客户端http请求，并响应301" class="headerlink" title="nginx 拦截了所有 客户端http请求，并响应301"></a>nginx 拦截了所有 客户端http请求，并响应301</h4><p>如上nginx拦截了所有http请求，并给它们重定向了 https， 此时nginx 相当于服务器；</p>
<h4 id="nginx-监听了所有请求https，并代理转发-反向代理"><a href="#nginx-监听了所有请求https，并代理转发-反向代理" class="headerlink" title="nginx 监听了所有请求https，并代理转发 (反向代理)"></a>nginx 监听了所有请求https，并代理转发 (反向代理)</h4><p>如上 nginx 监听了所有https请求，并将它们的请求转发代理到 对应的 Jenkins 或 apache 服务器上。</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><p>当所有访问都通过反向代理并且阻止对后端的直接访问时<br>安全性得到了增强。<br>如本例中， 客户端不直接访问后端，而是先与 nginx 之间进行https通信，增加了安全性；<br>再由nginx与后端 进行http 访问，不会被抓包。</p>
<h4 id="值得注意的是"><a href="#值得注意的是" class="headerlink" title="值得注意的是"></a>值得注意的是</h4><p>nginx 即可作为正向代理服务器，也可以作为反向代理服务器</p>
<h2 id="Squid-作为代理缓存服务器"><a href="#Squid-作为代理缓存服务器" class="headerlink" title="Squid 作为代理缓存服务器"></a>Squid 作为代理缓存服务器</h2><h3 id="代理缓存"><a href="#代理缓存" class="headerlink" title="代理缓存"></a>代理缓存</h3><p>使用代理缓存可以让用户获得更快的资源访问，也节省带宽；<br>代理缓存的另一个优点是它可以授权或禁止访问某些在线资源；<br>网站，端口，服务，等。可以为整个局域网设置全局的安全策略；</p>
<h3 id="使用代理缓存的几种方法"><a href="#使用代理缓存的几种方法" class="headerlink" title="使用代理缓存的几种方法"></a>使用代理缓存的几种方法</h3><ul>
<li>代理缓存的使用可以是可选的，非强制的</li>
<li>代理缓存的使用可以是强制且显式的，访问互联网的唯一方法是通过缓存，但用户必须手动配置其浏览器或其他应用程序</li>
<li>代理缓存的使用可以是强制且隐式的，用户无需任何配置；</li>
</ul>
<h3 id="Squid介绍"><a href="#Squid介绍" class="headerlink" title="Squid介绍"></a>Squid介绍</h3><p>Squid 鱿鱼 乌贼 的意思， 即可配置为正向代理，也可以配置为反向代理服务器；<br>默认监听3128端口</p>
<h3 id="squid-的配置文件"><a href="#squid-的配置文件" class="headerlink" title="squid 的配置文件"></a>squid 的配置文件</h3><p>主配置文件 <code>/etc/squid/squid.conf</code></p>
<p>筛选此文件的内容：grep -vE “^#|^$” /etc/squid/squid.conf<br>-E 是使用正常表达式 -v是取反  “^#|^$” “以井号开后|以结尾开头(空行)”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep -vE &quot;^#|^$&quot; /etc/squid/squid.conf</span><br><span class="line">acl localnet src 10.0.0.0/8     # RFC1918 possible internal network #localnet #acl 指令</span><br><span class="line">acl localnet src 172.16.0.0/12  # RFC1918 possible internal network #localnet #acl 指令</span><br><span class="line">acl localnet src 192.168.0.0/16 # RFC1918 possible internal network #localnet #acl 指令</span><br><span class="line">acl localnet src fc00::/7       # RFC 4193 local private network range #localnet #acl 指令，这是ipv6</span><br><span class="line">acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines #localnet #acl 指令，这是ipv6</span><br><span class="line">acl SSL_ports port 443</span><br><span class="line">acl Safe_ports port 80          # http</span><br><span class="line">acl Safe_ports port 21          # ftp</span><br><span class="line">acl Safe_ports port 443         # https</span><br><span class="line">acl Safe_ports port 70          # gopher</span><br><span class="line">acl Safe_ports port 210         # wais</span><br><span class="line">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports port 280         # http-mgmt</span><br><span class="line">acl Safe_ports port 488         # gss-http</span><br><span class="line">acl Safe_ports port 591         # filemaker</span><br><span class="line">acl Safe_ports port 777         # multiling http</span><br><span class="line">acl CONNECT method CONNECT</span><br><span class="line">http_access deny !Safe_ports  #拒绝非Safe_ports的端口</span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line">http_access allow localhost manager</span><br><span class="line">http_access deny manager</span><br><span class="line">http_access allow localnet</span><br><span class="line">http_access allow localhost</span><br><span class="line">http_access deny all  #http_access 的指令的结尾最好用 deny结尾，跟 switch breack一样</span><br><span class="line">http_port 3128</span><br><span class="line">coredump_dir /var/spool/squid</span><br><span class="line">refresh_pattern ^ftp:           1440    20%     10080</span><br><span class="line">refresh_pattern ^gopher:        1440    0%      1440</span><br><span class="line">refresh_pattern -i (/cgi-bin/|\?) 0     0%      0</span><br><span class="line">refresh_pattern .               0       20%     4320</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>
<h3 id="http-port-指令"><a href="#http-port-指令" class="headerlink" title="http_port 指令"></a>http_port 指令</h3><p>指定squid 监听的地址和端口<br>默认情况下，squid监听3128端口上所有的网络接口；<br>可以配置多个http_port指令，以便squid监听多个地址或端口</p>
<h3 id="acl-指令"><a href="#acl-指令" class="headerlink" title="acl 指令"></a>acl 指令</h3><p>access control lists缩写表示 访问控制列表<br>ACL是访问控制规则，这些规则之后将被 http_access使用<br>用于根据这些规则允许或禁止连接</p>
<p>下面是acl指令<br> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network</p>
<p>第二个字段是ACL的名称<br>具有相同名称的多个acl指令将叠加每个指令的条件</p>
<p>第三个字段是ACL的类型<br>最重要的是src 来源，<br>另外还有 dst 目的地， port 端口， time 时间；</p>
<p>第四个字段是acl的值<br>根据acl的类型，值可以是网络地址，端口 等等；</p>
<h3 id="http-access指令"><a href="#http-access指令" class="headerlink" title="http_access指令"></a>http_access指令</h3><p>http_access指令后接 allow 或 deny<br>用于控制对代理缓存的访问，拒绝或允许。<br>使用特点，建议以deny结尾，用！表示非。<br>http_access deny !Safe_ports  #拒绝非Safe_ports的端口<br>http_access deny all  #httpd 的指令的结尾最好用 deny结尾，跟 switch breack一样</p>
<h2 id="Squid使用举例"><a href="#Squid使用举例" class="headerlink" title="Squid使用举例"></a>Squid使用举例</h2><h3 id="Squid配置和使用"><a href="#Squid配置和使用" class="headerlink" title="Squid配置和使用"></a>Squid配置和使用</h3><h4 id="服务器安装squid"><a href="#服务器安装squid" class="headerlink" title="服务器安装squid"></a>服务器安装squid</h4><p>安装 <code>yum install squid</code></p>
<h4 id="配置客户机centos"><a href="#配置客户机centos" class="headerlink" title="配置客户机centos"></a>配置客户机centos</h4><p>先关闭客户机；<br>配置网络适配器，选择桥接模式<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu1.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu1.png" alt title class></a>
                <p></p>
            </figure><br>重启客户机，<br>目前客户机是可以正常上网的，我们将其设置为不能上网；<br>执行命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmtui</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu2.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu2.png" alt title class></a>
                <p></p>
            </figure>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu3.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu3.png" alt title class></a>
                <p></p>
            </figure>
<p>设置一个跟 服务器一样的段的地址，192.168.1.xxx, 这里设置为192.168.1.116<br>24是子网掩码为255.255.255.0 的意思；<br>网关和dns不要设置，这样客户机就不能上网，达到目的；<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu4.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu4.png" alt title class></a>
                <p></p>
            </figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[hz@localhost ~]$ systemctl restart network</span><br><span class="line"></span><br><span class="line">[hz@localhost ~]$ ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.116  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">[hz@localhost ~]$ ping baidu.com #不能联网</span><br><span class="line">ping: baidu.com: Name or service not known</span><br><span class="line">[hz@localhost ~]$ ping 192.168.1.109  #可以连到局域网</span><br><span class="line">--- 192.168.1.109 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.654/0.679/0.712/0.024 ms</span><br></pre></td></tr></table></figure>
<p>打开客户机火狐浏览器，设置如下：<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu5.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu5.png" alt title class></a>
                <p></p>
            </figure><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu6.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu6.png" alt title class></a>
                <p></p>
            </figure><br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu7.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu7.png" alt title class></a>
                <p></p>
            </figure><br>拒绝访问，原来是服务端没有开放3128 防火墙端口<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu8.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu8.png" alt title class></a>
                <p></p>
            </figure></p>
<h4 id="开放服务器端防火墙-3128端口"><a href="#开放服务器端防火墙-3128端口" class="headerlink" title="开放服务器端防火墙 3128端口"></a>开放服务器端防火墙 3128端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=3128/tcp --permanent</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@localhost ~]# firewall-cmd --list-ports</span><br><span class="line">443/tcp 80/tcp 3306/tcp 8080/tcp 7080/tcp 7443/tcp 3128/tcp</span><br></pre></td></tr></table></figure>
<p>为什么不用设置 SElinux 端口呢，<br>因为 SElinux 默认开放此端口，可以这样查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# semanage port -l | grep squid</span><br><span class="line">squid_port_t                   tcp      3128, 3401, 4827</span><br><span class="line">squid_port_t                   udp      3401, 4827</span><br></pre></td></tr></table></figure></p>
<h4 id="遇到dns解析问题"><a href="#遇到dns解析问题" class="headerlink" title="遇到dns解析问题"></a>遇到dns解析问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR</span><br><span class="line">The requested URL could not be retrieved</span><br></pre></td></tr></table></figure>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu9.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu9.png" alt title class></a>
                <p></p>
            </figure>
<p>原来是服务端 设置dns服务器不够的原因，<br><a href="https://www.365jz.com/article/24025" target="_blank" rel="noopener">设置过程参考博客</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat  /etc/resolv.conf</span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver 192.168.0.1   #这是原有的</span><br><span class="line">nameserver 202.106.0.20  #这是新增的 北京网通的DNS服务器地址</span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure></p>
<p>再次访问百度：<br>可以正常访问了<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/stu10.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/stu10.png" alt title class></a>
                <p></p>
            </figure></p>
<h4 id="如果还遇到问题"><a href="#如果还遇到问题" class="headerlink" title="如果还遇到问题"></a>如果还遇到问题</h4><p>据到服务器端，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart squid</span><br></pre></td></tr></table></figure></p>
<p>另外貌似每次服务器重启后， /etc/resolv.conf 配置文件就会被重制，要重新设置。</p>
<h3 id="其他应用场景"><a href="#其他应用场景" class="headerlink" title="其他应用场景"></a>其他应用场景</h3><h4 id="允许指定ip的客户机访问"><a href="#允许指定ip的客户机访问" class="headerlink" title="允许指定ip的客户机访问"></a>允许指定ip的客户机访问</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/squid/squid.conf</span><br><span class="line">#在顶部添加：</span><br><span class="line">#只允许 来自 192.168.1.107 ip 的客户端访问</span><br><span class="line">acl client src 192.168.1.107</span><br><span class="line">http_access allow client</span><br><span class="line">http_access deny all</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# systemctl restart squid</span><br></pre></td></tr></table></figure>
<p>因为客户机 非 192.168.1.107, 因此挂掉了。<br><figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/demo1.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/demo1.png" alt title class></a>
                <p></p>
            </figure></p>
<h4 id="禁止访问指定关键字url"><a href="#禁止访问指定关键字url" class="headerlink" title="禁止访问指定关键字url"></a>禁止访问指定关键字url</h4><p>禁止url包含taobao的页面访问，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl deny_keyword url_regex -i taobao   #url_regex 类型是url， 使用正则表达式匹配规则 -i表示忽略大小写 </span><br><span class="line">http_access deny deny_keyword</span><br></pre></td></tr></table></figure></p>
<figure class="image-box">
                <a rel=linux笔记(坎) href="/image/linuxfi/tao.png" title="undefined" data-fancybox="images"><img src="/image/linuxfi/tao.png" alt title class></a>
                <p></p>
            </figure>
<h4 id="禁止特定网站"><a href="#禁止特定网站" class="headerlink" title="禁止特定网站"></a>禁止特定网站</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl deny_url url_regex www.imooc.com   #url_regex 类型是url， 使用正则表达式匹配规则 禁止www.imooc.com 访问</span><br><span class="line">http_access deny deny_url</span><br></pre></td></tr></table></figure>
<h4 id="禁止下载指定类型的文件"><a href="#禁止下载指定类型的文件" class="headerlink" title="禁止下载指定类型的文件"></a>禁止下载指定类型的文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">acl deny_file urlpath_regex -i \.rar$ \.avi$ \.zip$ \.exe$  # urlpath_regex 类型是urlpath， 禁止文件下载</span><br><span class="line">http_access deny deny_file</span><br></pre></td></tr></table></figure>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2022-10-14T12:41:03.951Z" itemprop="dateUpdated">2022-10-14 12:41:03</time>
</span><br>


        
        博客内容均为原创，转载注明出处，原文地址：<a href="/2021/06/16/linux_five/" target="_blank" rel="external">https://yewills.github.io/2021/06/16/linux_five/</a>
        
    </div>
    <footer>
        <a href="https://yewills.github.io">
            <img src="/img/avatar.jpg" alt="Mr.Yellow">
            Mr.Yellow
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2021/06/16/linux_five/&title=《linux笔记(坎)》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2021/06/16/linux_five/&title=《linux笔记(坎)》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2021/06/19/linux_six/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">linux笔记(离)</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2021/06/08/linux_fore/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">linux笔记(巽)</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nginx-服务器"><span class="post-toc-number">1.</span> <span class="post-toc-text">Nginx 服务器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#介绍"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#apache、nginx、IIS"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">apache、nginx、IIS</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装和使用nginx"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">安装和使用nginx</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#安装"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">安装</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#两种启动方式"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">两种启动方式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#启动nginx失败的解决方法"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">启动nginx失败的解决方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#nginx语法"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">nginx语法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#全局变量"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">全局变量</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#花括号-局部变量-和-区块"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">花括号(局部变量 和 区块)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定义一个名字"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">定义一个名字</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#include-导入"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">include 导入</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#以分号结尾"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">以分号结尾</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#nginx-其他知识介绍"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">nginx 其他知识介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#server-虚拟主机-和-端口服务等"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">server (虚拟主机 和 端口服务等)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#全局变量含义介绍"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">全局变量含义介绍</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nginx主配置文件"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">nginx主配置文件</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置nginx为反向代理，设置https"><span class="post-toc-number">2.</span> <span class="post-toc-text">配置nginx为反向代理，设置https</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置https方案"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">配置https方案</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#修改apache"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">修改apache</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#修改apache-80-443-端口"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">修改apache 80 443 端口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#重启apache报错"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">重启apache报错</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SElinux-增加端口7080-7443"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">SElinux 增加端口7080 7443</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#防火墙-增加端口7080-7443"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">防火墙 增加端口7080 7443</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#访问网站"><span class="post-toc-number">2.2.5.</span> <span class="post-toc-text">访问网站</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#访问失败的解决方法"><span class="post-toc-number">2.2.6.</span> <span class="post-toc-text">访问失败的解决方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置nginx为http-反向代理"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">配置nginx为http 反向代理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置nginx的http"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">配置nginx的http</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#解决棘手的配置重载报错"><span class="post-toc-number">2.3.2.</span> <span class="post-toc-text">解决棘手的配置重载报错</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置nginx的http成功"><span class="post-toc-number">2.3.3.</span> <span class="post-toc-text">配置nginx的http成功</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#nginx-配置https-反向代理"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">nginx 配置https 反向代理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#生成-证书和私钥"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">生成 证书和私钥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置-443端口"><span class="post-toc-number">2.4.2.</span> <span class="post-toc-text">配置 443端口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#在80-端口-区块中定义："><span class="post-toc-number">2.4.3.</span> <span class="post-toc-text">在80 端口 区块中定义：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#完整的配置"><span class="post-toc-number">2.4.4.</span> <span class="post-toc-text">完整的配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#浏览器访问http-会-自动转-https"><span class="post-toc-number">2.4.5.</span> <span class="post-toc-text">浏览器访问http 会 自动转 https</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#过程分析"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">过程分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#过程描述"><span class="post-toc-number">2.5.1.</span> <span class="post-toc-text">过程描述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nginx-拦截了所有-客户端http请求，并响应301"><span class="post-toc-number">2.5.2.</span> <span class="post-toc-text">nginx 拦截了所有 客户端http请求，并响应301</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nginx-监听了所有请求https，并代理转发-反向代理"><span class="post-toc-number">2.5.3.</span> <span class="post-toc-text">nginx 监听了所有请求https，并代理转发 (反向代理)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#优点"><span class="post-toc-number">2.5.4.</span> <span class="post-toc-text">优点</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#值得注意的是"><span class="post-toc-number">2.5.5.</span> <span class="post-toc-text">值得注意的是</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Squid-作为代理缓存服务器"><span class="post-toc-number">3.</span> <span class="post-toc-text">Squid 作为代理缓存服务器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#代理缓存"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">代理缓存</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用代理缓存的几种方法"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">使用代理缓存的几种方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Squid介绍"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">Squid介绍</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#squid-的配置文件"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">squid 的配置文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#http-port-指令"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">http_port 指令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#acl-指令"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">acl 指令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#http-access指令"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">http_access指令</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Squid使用举例"><span class="post-toc-number">4.</span> <span class="post-toc-text">Squid使用举例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Squid配置和使用"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Squid配置和使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#服务器安装squid"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">服务器安装squid</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置客户机centos"><span class="post-toc-number">4.1.2.</span> <span class="post-toc-text">配置客户机centos</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#开放服务器端防火墙-3128端口"><span class="post-toc-number">4.1.3.</span> <span class="post-toc-text">开放服务器端防火墙 3128端口</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#遇到dns解析问题"><span class="post-toc-number">4.1.4.</span> <span class="post-toc-text">遇到dns解析问题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#如果还遇到问题"><span class="post-toc-number">4.1.5.</span> <span class="post-toc-text">如果还遇到问题</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#其他应用场景"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">其他应用场景</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#允许指定ip的客户机访问"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">允许指定ip的客户机访问</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#禁止访问指定关键字url"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">禁止访问指定关键字url</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#禁止特定网站"><span class="post-toc-number">4.2.3.</span> <span class="post-toc-text">禁止特定网站</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#禁止下载指定类型的文件"><span class="post-toc-number">4.2.4.</span> <span class="post-toc-text">禁止下载指定类型的文件</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

        <footer class="footer">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Mr.Yellow &copy; 2017 - 2022
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2021/06/16/linux_five/&title=《linux笔记(坎)》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2021/06/16/linux_five/&title=《linux笔记(坎)》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACM0lEQVR42u3aS5KDMAxFUfa/aTLpKeY+yZ2K7csoVQHsw0Blfa4LX/fDRe7n95CnWpcMGTKWZdzDq7MAecPTWnxvMmTIOIdBNjH+/bQwX2tMenmPDBkyZAw3NA7HnS3KkCFDRifg8kPe+KjHj4kyZMiQQZJYnmSStDb9ZNNycRkyZCzIqBXOvvP7X/obMmTIWIpxh1caBPlhsbafv2dlyJCxNYMHuHTrswJ3MMwhQ4aMAxi1jcZhMd0caEvIkCHjNAYv6JNyf+3OtMwnQ4aMvRn9l/IkllP5AMc169vIkCHjhxnpIMV3tlgcGpMhQ8amDP66OPyVEtS0kRB/FRkyZCzL4Ivx8lmnVRm3E2TIkLE1Iy2l8Tp82pIkDYCgaihDhoxNGZ2BibTp2DluPj4lQ4aMYxhp25IU4HiQ7STJMmTIOI3Bj3ecypudxUAvQ4aMTRm1hWvtTH7ojMt5MmTI2JqRDjrUDnB8+KwW4mXIkHECgy/TKeuT0Mxbpy+TIzJkyDiAwYPjrFEJNE4x/nAyZMg4gEEqc+TfdPwrHeYIqoYyZMjYjlEbyUqDY21cLE5iZciQsRHjDi+SmqaDX63ENT23ypAhY0FGLcyl3YY0QeXJbQyTIUPGsoxOkE1HuMhXTBsSMmTIOIfBA1+6XZIe8+2+nHNlyJAhY9JwWOf+yQFXhgwZBzPiBuTwzSiUy5Ah4wBGOhKRlthI6OyMesiQIWNvRu3c1Ud2CnbFpqYMGTLWY3wAX5OJhzHVdEUAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/js/plugins/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/plugins/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/plugins/MathJax.js"></script>
<script type="text/javascript" src="/js/plugins/TeX-AMS-MML_HTMLorMML.js"></script>
<script type="text/javascript" src="/js/plugins/MathMenu.js"></script>
<script type="text/javascript" src="/js/plugins/MathZoom.js"></script>

<script type="text/javascript" src="/js/plugins/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.9"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.9"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.9"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src=""></script>







    
</body>
</html>
