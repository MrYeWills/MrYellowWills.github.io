<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>umi系列(二)：基础知识，如umi dev过程分析 | Mr.Yellow.Wills</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="umi">
    <link rel="shortcut icon" href="/blog/img/logo.jpg">
    <link rel="stylesheet" href="/blog/css/jquery.fancybox.min.css?v=1.3.9">
    <link rel="stylesheet" href="/blog/css/style.css?v=1.3.9">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/blog/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/blog/" class="avatar waves-effect waves-circle waves-light">
          <img src="/blog/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Mr.Yellow</h5>
          <a href="mailto:601661706@qq.com" title="601661706@qq.com" class="mail">
            
              <span>6</span>
            
              <span>0</span>
            
              <span>1</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>1</span>
            
              <span>7</span>
            
              <span>0</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/YeWills/YeWills.github.io/tree/blog_code" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/blog/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/blog/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/blog/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/blog/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>umi系列(二)：基础知识，如umi dev过程分析</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/blog/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">umi系列(二)：基础知识，如umi dev过程分析</h1>
        <h5 class="subtitle">
            
                <time datetime="2022-05-06T00:00:00.000Z" itemprop="datePublished" class="page-time">
  2022-05-06
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/blog/categories/umi系列/">umi系列</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-umi_two"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">umi系列(二)：基础知识，如umi dev过程分析</h1>
        <div class="post-meta">
            <time class="post-time" title="2022-05-06 00:00:00" datetime="2022-05-06T00:00:00.000Z"  itemprop="datePublished">2022-05-06</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/blog/categories/umi系列/">umi系列</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <p><em>源码 umi 版本为 version-4.0.0-rc.15</em></p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="预编译-与-father"><a href="#预编译-与-father" class="headerlink" title="预编译 与 father"></a>预编译 与 father</h3><p>father 内置了 预编译；</p>
<h3 id="如何集成-preset-umi"><a href="#如何集成-preset-umi" class="headerlink" title="如何集成 preset-umi"></a>如何集成 preset-umi</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\umi\src\service\service.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的 super 实际上是</span></span><br><span class="line"><span class="keyword">super</span>(&#123;</span><br><span class="line">      ...opts,</span><br><span class="line">      env: process.env.NODE_ENV,</span><br><span class="line">      cwd,</span><br><span class="line">      defaultConfigFiles: DEFAULT_CONFIG_FILES,</span><br><span class="line">      frameworkName: FRAMEWORK_NAME,</span><br><span class="line">      presets: [<span class="built_in">require</span>.resolve(<span class="string">'@umijs/preset-umi'</span>), ...(opts?.presets || [])],</span><br><span class="line">      plugins: [</span><br><span class="line">        existsSync(join(cwd, <span class="string">'plugin.ts'</span>)) &amp;&amp; join(cwd, <span class="string">'plugin.ts'</span>),</span><br><span class="line">        existsSync(join(cwd, <span class="string">'plugin.js'</span>)) &amp;&amp; join(cwd, <span class="string">'plugin.js'</span>),</span><br><span class="line">      ].filter(<span class="built_in">Boolean</span>),</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="如何集成-bundler-webpack"><a href="#如何集成-bundler-webpack" class="headerlink" title="如何集成 bundler-webpack"></a>如何集成 bundler-webpack</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\preset-umi\src\commands\dev\dev.ts</span></span><br><span class="line"><span class="keyword">const</span> bundlerWebpack=</span><br><span class="line">  lazyImportFromCurrentPkg(<span class="string">'@umijs/bundler-webpack'</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> (enableVite) &#123;</span><br><span class="line">	<span class="keyword">await</span> bundlerVite.dev(opts);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">await</span> bundlerWebpack.dev(opts);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这里的 bundlerWebpack.dev 其实就是<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\dev.ts</span></span><br><span class="line"><span class="keyword">import</span> webpack <span class="keyword">from</span> <span class="string">'../compiled/webpack'</span>;</span><br><span class="line"></span><br><span class="line">  mfsu = <span class="keyword">new</span> MFSU(&#123;</span><br><span class="line">      implementor: webpack <span class="keyword">as</span> any,</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如上可知，配置了 <code>@umijs/preset-umi</code> 进行打包，那么就会只用 webpack 5 进行打包；</p>
<h3 id="如何集成-webpack-5"><a href="#如何集成-webpack-5" class="headerlink" title="如何集成 webpack 5"></a>如何集成 webpack 5</h3><p>参考以上</p>
<h3 id="如何-webpack-5项目结合-MFSU"><a href="#如何-webpack-5项目结合-MFSU" class="headerlink" title="如何 webpack 5项目结合 MFSU"></a>如何 webpack 5项目结合 MFSU</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//examples\mfsu-independent\webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> mfsu = <span class="keyword">new</span> MFSU(&#123;</span><br><span class="line">  implementor: webpack,</span><br><span class="line">  buildDepWithESBuild: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="webpack-5-chain-如何结合-webpack-5"><a href="#webpack-5-chain-如何结合-webpack-5" class="headerlink" title="webpack-5-chain 如何结合 webpack 5"></a>webpack-5-chain 如何结合 webpack 5</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\config\config.ts</span></span><br><span class="line"><span class="keyword">import</span> Config <span class="keyword">from</span> <span class="string">'../../compiled/webpack-5-chain'</span>;</span><br><span class="line"><span class="comment">// 其实就是 @umijs/bundler-webpack/compiled/webpack-5-chain</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> config = <span class="keyword">new</span> Config();</span><br></pre></td></tr></table></figure>
<h3 id="babel配置如何集成"><a href="#babel配置如何集成" class="headerlink" title="babel配置如何集成"></a>babel配置如何集成</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\dev.ts</span></span><br><span class="line"><span class="comment">// getConfig 为 packages\bundler-webpack\src\config\config.ts</span></span><br><span class="line">  <span class="keyword">const</span> webpackConfig = <span class="keyword">await</span> getConfig(&#123;</span><br><span class="line">    cwd: opts.cwd,</span><br><span class="line">    rootDir: opts.rootDir,</span><br><span class="line">    env: Env.development,</span><br><span class="line">    entry: opts.entry,</span><br><span class="line">    userConfig: opts.config,</span><br><span class="line">    babelPreset: opts.babelPreset,</span><br><span class="line">    extraBabelPlugins: [</span><br><span class="line">      ...(opts.beforeBabelPlugins || []),</span><br><span class="line">      ...(mfsu?.getBabelPlugins() || []),</span><br><span class="line">      ...(opts.extraBabelPlugins || []),</span><br><span class="line">    ],</span><br><span class="line">    extraBabelPresets: [</span><br><span class="line">      ...(opts.beforeBabelPresets || []),</span><br><span class="line">      ...(opts.extraBabelPresets || []),</span><br><span class="line">    ],</span><br><span class="line">    extraBabelIncludes: opts.config.extraBabelIncludes,</span><br><span class="line">    extraEsbuildLoaderHandler: mfsu?.getEsbuildLoaderHandler() || [],</span><br><span class="line">    chainWebpack: opts.chainWebpack,</span><br><span class="line">    modifyWebpackConfig: opts.modifyWebpackConfig,</span><br><span class="line">    hmr: <span class="literal">true</span>,</span><br><span class="line">    analyze: process.env.ANALYZE,</span><br><span class="line">    cache: opts.cache,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\config\config.ts</span></span><br><span class="line"><span class="comment">// getConfig 函数中包含 addJavaScriptRules ，</span></span><br><span class="line"><span class="comment">// 此函数为 packages\bundler-webpack\src\config\javaScriptRules.ts：</span></span><br><span class="line">  <span class="comment">// rules</span></span><br><span class="line">  <span class="keyword">await</span> addJavaScriptRules(applyOpts);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\config\javaScriptRules.ts</span></span><br><span class="line"><span class="comment">// addJavaScriptRules:</span></span><br><span class="line"> rule</span><br><span class="line">        .use(<span class="string">'babel-loader'</span>)</span><br><span class="line">        .loader(<span class="built_in">require</span>.resolve(<span class="string">'../../compiled/babel-loader'</span>))</span><br><span class="line">        .options(&#123;</span><br><span class="line">          <span class="comment">// Tell babel to guess the type, instead assuming all files are modules</span></span><br><span class="line">          <span class="comment">// https://github.com/webpack/webpack/issues/4039#issuecomment-419284940</span></span><br><span class="line">          sourceType: <span class="string">'unambiguous'</span>,</span><br><span class="line">          babelrc: <span class="literal">false</span>,</span><br><span class="line">          cacheDirectory: <span class="literal">false</span>,</span><br><span class="line">          targets: userConfig.targets,</span><br><span class="line">          presets: [</span><br><span class="line">            opts.babelPreset || [</span><br><span class="line">              <span class="built_in">require</span>.resolve(<span class="string">'@umijs/babel-preset-umi'</span>),</span><br><span class="line">              ...</span><br><span class="line">          ],</span><br><span class="line">          plugins: [</span><br><span class="line">            ...</span><br><span class="line">          ]</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="umirc-配置的读取和使用"><a href="#umirc-配置的读取和使用" class="headerlink" title=".umirc 配置的读取和使用"></a>.umirc 配置的读取和使用</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\core\src\service\service.ts</span></span><br><span class="line"><span class="keyword">async</span> run(opts: &#123; <span class="attr">name</span>: string; args?: any &#125;) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> configManager = <span class="keyword">new</span> Config(&#123;</span><br><span class="line">      cwd: <span class="keyword">this</span>.cwd,</span><br><span class="line">      env: <span class="keyword">this</span>.env,</span><br><span class="line">      <span class="comment">// defaultConfigFiles这个值终将被设置到 this.mainConfigFile 中</span></span><br><span class="line">      <span class="comment">// this.opts.defaultConfigFiles </span></span><br><span class="line">      defaultConfigFiles: <span class="keyword">this</span>.opts.defaultConfigFiles,</span><br><span class="line">      specifiedEnv: process.env[<span class="string">`<span class="subst">$&#123;prefix&#125;</span>_ENV`</span>.toUpperCase()],</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里读取 .umirc 的配置</span></span><br><span class="line">    <span class="keyword">this</span>.userConfig = configManager.getUserConfig().config;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// configManager.getUserConfig 出自：</span></span><br><span class="line"><span class="comment">// packages\core\src\config\config.ts</span></span><br><span class="line"> getUserConfig() &#123;</span><br><span class="line">    <span class="keyword">const</span> configFiles = Config.getConfigFiles(&#123;</span><br><span class="line">      <span class="comment">// this.mainConfigFile 就是 .umirc 文件</span></span><br><span class="line">      mainConfigFile: <span class="keyword">this</span>.mainConfigFile,</span><br><span class="line">      env: <span class="keyword">this</span>.opts.env,</span><br><span class="line">      specifiedEnv: <span class="keyword">this</span>.opts.specifiedEnv,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> Config.getUserConfig(&#123;</span><br><span class="line">      configFiles: getAbsFiles(&#123;</span><br><span class="line">        files: configFiles,</span><br><span class="line">        cwd: <span class="keyword">this</span>.opts.cwd,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="关于-this-opts-defaultConfigFiles"><a href="#关于-this-opts-defaultConfigFiles" class="headerlink" title="关于 this.opts.defaultConfigFiles"></a>关于 this.opts.defaultConfigFiles</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// packages\umi\src\service\service.ts</span></span><br><span class="line"><span class="comment">// 上面的 this.opts.defaultConfigFiles 来源于 这个ts的：</span></span><br><span class="line"><span class="keyword">import</span> &#123; DEFAULT_CONFIG_FILES &#125; <span class="keyword">from</span> <span class="string">'../constants'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(opts?: any) &#123;</span><br><span class="line">    process.env.UMI_DIR = dirname(<span class="built_in">require</span>.resolve(<span class="string">'../../package'</span>));</span><br><span class="line">    <span class="keyword">const</span> cwd = getCwd();</span><br><span class="line">    <span class="keyword">super</span>(&#123;</span><br><span class="line">      ...</span><br><span class="line">      defaultConfigFiles: DEFAULT_CONFIG_FILES,</span><br><span class="line">      ...</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\umi\src\constants.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEFAULT_CONFIG_FILES = [</span><br><span class="line">  <span class="string">'.umirc.ts'</span>,</span><br><span class="line">  <span class="string">'.umirc.js'</span>,</span><br><span class="line">  <span class="string">'config/config.ts'</span>,</span><br><span class="line">  <span class="string">'config/config.js'</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="如何生成-umi"><a href="#如何生成-umi" class="headerlink" title="如何生成.umi"></a>如何生成.umi</h3><h4 id="packages-preset-umi-src-commands-dev-dev-ts"><a href="#packages-preset-umi-src-commands-dev-dev-ts" class="headerlink" title="packages\preset-umi\src\commands\dev\dev.ts"></a>packages\preset-umi\src\commands\dev\dev.ts</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\preset-umi\src\commands\dev\dev.ts</span></span><br><span class="line"> <span class="keyword">async</span> fn() &#123;</span><br><span class="line">      <span class="comment">// generate files</span></span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">generate</span>(<span class="params">opts: &#123; isFirstTime?: boolean; files?: any &#125;</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">await</span> api.applyPlugins(&#123;</span><br><span class="line">          key: <span class="string">'onGenerateFiles'</span>,</span><br><span class="line">          args: &#123;</span><br><span class="line">            files: opts.files || <span class="literal">null</span>,</span><br><span class="line">            isFirstTime: opts.isFirstTime,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">await</span> generate(&#123;</span><br><span class="line">        isFirstTime: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">      <span class="comment">// watch plugin change</span></span><br><span class="line">      <span class="keyword">const</span> pluginFiles: string[] = [</span><br><span class="line">        join(api.cwd, <span class="string">'plugin.ts'</span>),</span><br><span class="line">        join(api.cwd, <span class="string">'plugin.js'</span>),</span><br><span class="line">      ];</span><br><span class="line">      pluginFiles.forEach(<span class="function">(<span class="params">filePath: string</span>) =&gt;</span> &#123;</span><br><span class="line">        watch(&#123;</span><br><span class="line">          path: filePath,</span><br><span class="line">          addToUnWatches: <span class="literal">true</span>,</span><br><span class="line">          onChange() &#123;</span><br><span class="line">            logger.event(<span class="string">`<span class="subst">$&#123;basename(filePath)&#125;</span> changed, restart server...`</span>);</span><br><span class="line">            api.restartServer();</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">      <span class="keyword">if</span> (enableVite) &#123;</span><br><span class="line">        <span class="keyword">await</span> bundlerVite.dev(opts);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> bundlerWebpack.dev(opts);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="preset-umi-src-features-tmpFiles-tmpFiles-ts"><a href="#preset-umi-src-features-tmpFiles-tmpFiles-ts" class="headerlink" title="preset-umi\src\features\tmpFiles\tmpFiles.ts"></a>preset-umi\src\features\tmpFiles\tmpFiles.ts</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\preset-umi\src\features\tmpFiles\tmpFiles.ts</span></span><br><span class="line">api.onGenerateFiles(<span class="keyword">async</span> (opts) =&gt; &#123;</span><br><span class="line">  ....</span><br><span class="line">   <span class="comment">// 例如生成 history.ts</span></span><br><span class="line">    api.writeTmpFile(&#123;</span><br><span class="line">      noPluginDir: <span class="literal">true</span>,</span><br><span class="line">      path: <span class="string">'core/history.ts'</span>,</span><br><span class="line">      tplPath: join(TEMPLATES_DIR, <span class="string">'history.tpl'</span>),</span><br><span class="line">      context: &#123;</span><br><span class="line">        rendererPath,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">   api.register(&#123;</span><br><span class="line">    key: <span class="string">'onGenerateFiles'</span>,</span><br><span class="line">    fn: <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">      api.writeTmpFile(&#123;</span><br><span class="line">        noPluginDir: <span class="literal">true</span>,</span><br><span class="line">        path: <span class="string">'exports.ts'</span>,</span><br><span class="line">        content: exports.join(<span class="string">'\n'</span>),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    stage: <span class="literal">Infinity</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="tpl"><a href="#tpl" class="headerlink" title="tpl"></a>tpl</h4><p>各种tpl模板位置如： <code>packages\preset-umi\templates\history.tpl</code></p>
<h4 id="关键的commands-dev-dev-ts"><a href="#关键的commands-dev-dev-ts" class="headerlink" title="关键的commands\dev\dev.ts"></a>关键的<code>commands\dev\dev.ts</code></h4><p>从这个例子看出，整个项目的初始化，以及各种文件生成 等等 事情，都可以在 <code>packages\preset-umi\src\commands\dev\dev.ts</code> 找到答案。</p>
<h2 id="umi-dev-过程源码分析"><a href="#umi-dev-过程源码分析" class="headerlink" title="umi dev 过程源码分析"></a>umi dev 过程源码分析</h2><h3 id="过程概述"><a href="#过程概述" class="headerlink" title="过程概述"></a>过程概述</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">packages\umi\bin\umi.js</span><br><span class="line">packages\umi\src\cli\cli.ts</span><br><span class="line">packages\umi\src\cli\dev.ts</span><br><span class="line">packages\umi\src\cli\fork.ts</span><br><span class="line">packages\umi\bin\forkedDev.js</span><br><span class="line"><span class="comment">// 在这里引入下面的service.ts</span></span><br><span class="line">packages\umi\src\cli\forkedDev.ts</span><br><span class="line"><span class="comment">// 在这里引入下面的service.ts</span></span><br><span class="line">packages\umi\src\service\service.ts</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心</span></span><br><span class="line">packages\core\src\service\service.ts</span><br><span class="line">packages\preset-umi\src\commands\dev\dev.ts</span><br><span class="line">packages\bundler-webpack\src\dev.ts</span><br><span class="line">packages\bundler-webpack\src\server\server.ts</span><br></pre></td></tr></table></figure>
<p>下面介绍详细过程：</p>
<h3 id="准备过程"><a href="#准备过程" class="headerlink" title="准备过程"></a>准备过程</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">packages\umi\bin\umi.js</span><br><span class="line">packages\umi\src\cli\cli.ts</span><br><span class="line">packages\umi\src\cli\dev.ts</span><br><span class="line">packages\umi\src\cli\fork.ts</span><br><span class="line">packages\umi\bin\forkedDev.js</span><br></pre></td></tr></table></figure>
<h3 id="packages-umi-src-cli-forkedDev-ts"><a href="#packages-umi-src-cli-forkedDev-ts" class="headerlink" title="packages\umi\src\cli\forkedDev.ts"></a>packages\umi\src\cli\forkedDev.ts</h3><p>在这里引入下面的service.ts<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\umi\src\cli\forkedDev.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//'../service/service' 就是  packages\umi\src\service\service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Service &#125; <span class="keyword">from</span> <span class="string">'../service/service'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> service = <span class="keyword">new</span> Service();</span><br><span class="line">    <span class="keyword">await</span> service.run2(&#123;</span><br><span class="line">      name: DEV_COMMAND,</span><br><span class="line">      args,</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="packages-umi-src-service-service-ts"><a href="#packages-umi-src-service-service-ts" class="headerlink" title="packages\umi\src\service\service.ts"></a>packages\umi\src\service\service.ts</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//packages\umi\src\service\service.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这个 import &#123; Service as CoreService &#125; from '@umijs/core'; </span></span><br><span class="line"><span class="comment">//其实就是 packages\core\src\service\service.ts ，这是核心</span></span><br><span class="line"><span class="keyword">import</span> &#123; Service <span class="keyword">as</span> CoreService &#125; <span class="keyword">from</span> <span class="string">'@umijs/core'</span>;</span><br><span class="line">   <span class="keyword">super</span>(&#123;</span><br><span class="line">      ...opts,</span><br><span class="line">      env: process.env.NODE_ENV,</span><br><span class="line">      cwd,</span><br><span class="line">      defaultConfigFiles: DEFAULT_CONFIG_FILES,</span><br><span class="line">      frameworkName: FRAMEWORK_NAME,</span><br><span class="line">      presets: [<span class="built_in">require</span>.resolve(<span class="string">'@umijs/preset-umi'</span>), ...(opts?.presets || [])],</span><br><span class="line">      plugins: [</span><br><span class="line">        existsSync(join(cwd, <span class="string">'plugin.ts'</span>)) &amp;&amp; join(cwd, <span class="string">'plugin.ts'</span>),</span><br><span class="line">        existsSync(join(cwd, <span class="string">'plugin.js'</span>)) &amp;&amp; join(cwd, <span class="string">'plugin.js'</span>),</span><br><span class="line">      ].filter(<span class="built_in">Boolean</span>),</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>如上 在这个js上，除了在构造函数上初始化 umi/core 的service外，还在其 run2 方法中调用 了core 的run 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//packages\umi\src\service\service.ts</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">async</span> run2(opts: &#123; <span class="attr">name</span>: string; args?: any &#125;) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.run(&#123; ...opts, name &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>到此，所有的工作都转给 核心  @umijs/core 的 service 类来处理了。</p>
<h3 id="（核心-umijs-core）-packages-core-src-service-service-ts"><a href="#（核心-umijs-core）-packages-core-src-service-service-ts" class="headerlink" title="（核心@umijs/core） packages\core\src\service\service.ts"></a>（核心@umijs/core） packages\core\src\service\service.ts</h3><p>在 <code>packages\core\src\service\service.ts</code>中执行 run 方法，方法内部执行 注册的 dev 命令<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">packages\core\src\service\service.ts</span><br><span class="line"><span class="keyword">async</span> run(opts: &#123; <span class="attr">name</span>: string; args?: any &#125;) &#123;</span><br><span class="line">  <span class="comment">// 这里的 command 包含了 dev 命令</span></span><br><span class="line">  <span class="keyword">let</span> ret = <span class="keyword">await</span> command.fn(&#123; args &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="packages-preset-umi-src-commands-dev-dev-ts-1"><a href="#packages-preset-umi-src-commands-dev-dev-ts-1" class="headerlink" title="packages\preset-umi\src\commands\dev\dev.ts"></a>packages\preset-umi\src\commands\dev\dev.ts</h3><p>此 dev命令 在这里注册：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\preset-umi\src\commands\dev\dev.ts</span></span><br><span class="line"><span class="keyword">const</span> bundlerWebpack = lazyImportFromCurrentPkg(<span class="string">'@umijs/bundler-webpack'</span>);</span><br><span class="line">api.registerCommand(&#123;</span><br><span class="line">  name: <span class="string">'dev'</span>,</span><br><span class="line">  description: <span class="string">'dev server for development'</span>,</span><br><span class="line">  details: <span class="string">`</span></span><br><span class="line"><span class="string">umi dev</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># dev with specified port</span></span><br><span class="line"><span class="string">PORT=8888 umi dev</span></span><br><span class="line"><span class="string">`</span>,</span><br><span class="line">  <span class="keyword">async</span> fn() &#123;</span><br><span class="line">    <span class="keyword">if</span> (enableVite) &#123;</span><br><span class="line">      <span class="keyword">await</span> bundlerVite.dev(opts);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 执行这里</span></span><br><span class="line">      <span class="keyword">await</span> bundlerWebpack.dev(opts);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="packages-bundler-webpack-src-dev-ts"><a href="#packages-bundler-webpack-src-dev-ts" class="headerlink" title="packages\bundler-webpack\src\dev.ts"></a>packages\bundler-webpack\src\dev.ts</h3><p>因此执行来到 <code>bundlerWebpack.dev(opts)</code>,此方法定义在 <code>packages\bundler-webpack\src\dev.ts</code><br>dev 会执行 createServer 方法，</p>
<h3 id="packages-bundler-webpack-src-server-server-ts"><a href="#packages-bundler-webpack-src-server-server-ts" class="headerlink" title="packages\bundler-webpack\src\server\server.ts"></a>packages\bundler-webpack\src\server\server.ts</h3><p>createServer 的逻辑在 <code>packages\bundler-webpack\src\server\server.ts</code><br>createServer 主要做 webpack 编译 以及 然后通过 express 创建 dev server，<br>这里可以打印相关的 webpack 配置等等。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages\bundler-webpack\src\server\server.ts</span></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(configs);</span><br></pre></td></tr></table></figure></p>
<p>至此整个 umi dev 的流程走完了。</p>
<h3 id="要点对象"><a href="#要点对象" class="headerlink" title="要点对象"></a>要点对象</h3><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Service &#123;</span><br><span class="line">  appData: &#123;&#125;,</span><br><span class="line">  args: &#123; <span class="attr">_</span>: [], <span class="string">'$0'</span>: <span class="string">''</span> &#125;,</span><br><span class="line">  commands: &#123;&#125;,</span><br><span class="line">  generators: &#123;&#125;,</span><br><span class="line">  config: &#123;&#125;,</span><br><span class="line">  configSchemas: &#123;&#125;,</span><br><span class="line">  configDefaults: &#123;&#125;,</span><br><span class="line">  configOnChanges: &#123;&#125;,</span><br><span class="line">  hooks: &#123;&#125;,</span><br><span class="line">  name: <span class="string">''</span>,</span><br><span class="line">  paths: &#123;&#125;,</span><br><span class="line">  plugins: &#123;&#125;,</span><br><span class="line">  keyToPluginMap: &#123;&#125;,</span><br><span class="line">  pluginMethods: &#123;&#125;,</span><br><span class="line">  skipPluginIds: <span class="built_in">Set</span>(<span class="number">0</span>) &#123;&#125;,</span><br><span class="line">  stage: <span class="number">0</span>,</span><br><span class="line">  userConfig: &#123;&#125;,</span><br><span class="line">  configManager: <span class="literal">null</span>,</span><br><span class="line">  pkg: &#123;&#125;,</span><br><span class="line">  pkgPath: <span class="string">''</span>,</span><br><span class="line">  cwd: <span class="string">'D:\\git\\umi\\travel-um'</span>,</span><br><span class="line">  env: <span class="string">'development'</span>,</span><br><span class="line">  opts: &#123;</span><br><span class="line">    env: <span class="string">'development'</span>,</span><br><span class="line">    cwd: <span class="string">'D:\\git\\umi\\travel-um'</span>,</span><br><span class="line">    defaultConfigFiles: [</span><br><span class="line">      <span class="string">'.umirc.ts'</span>,</span><br><span class="line">      <span class="string">'.umirc.js'</span>,</span><br><span class="line">      <span class="string">'config/config.ts'</span>,</span><br><span class="line">      <span class="string">'config/config.js'</span></span><br><span class="line">    ],</span><br><span class="line">    frameworkName: <span class="string">'umi'</span>,</span><br><span class="line">    presets: [</span><br><span class="line">      <span class="string">'D:\\git\\umi\\travel-um\\node_modules\\@umijs\\preset-umi\\dist\\index.js'</span></span><br><span class="line">    ],</span><br><span class="line">    plugins: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="webpack-config"><a href="#webpack-config" class="headerlink" title="webpack.config"></a>webpack.config</h4><p>见《umi系列(end) – webpack.config》</p>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-08T08:44:59.809Z" itemprop="dateUpdated">2024-04-08 08:44:59</time>
</span><br>


        
        博客内容均为原创，转载注明出处，原文地址：<a href="/blog/2022/05/06/umi_two/" target="_blank" rel="external">https://yewills.github.io/2022/05/06/umi_two/</a>
        
    </div>
    <footer>
        <a href="https://yewills.github.io">
            <img src="/blog/img/avatar.jpg" alt="Mr.Yellow">
            Mr.Yellow
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/umi/">umi</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2022/05/06/umi_two/&title=《umi系列(二)：基础知识，如umi dev过程分析》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2022/05/06/umi_two/&title=《umi系列(二)：基础知识，如umi dev过程分析》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/blog/2022/05/11/umi_end/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">umi系列(end)：附录、参考</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/blog/2022/04/30/umi_one/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">umi系列(一)：学习策略</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#基础知识"><span class="post-toc-number">1.</span> <span class="post-toc-text">基础知识</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#预编译-与-father"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">预编译 与 father</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何集成-preset-umi"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">如何集成 preset-umi</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何集成-bundler-webpack"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">如何集成 bundler-webpack</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何集成-webpack-5"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">如何集成 webpack 5</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何-webpack-5项目结合-MFSU"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">如何 webpack 5项目结合 MFSU</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#webpack-5-chain-如何结合-webpack-5"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">webpack-5-chain 如何结合 webpack 5</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#babel配置如何集成"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">babel配置如何集成</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#umirc-配置的读取和使用"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">.umirc 配置的读取和使用</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#概述"><span class="post-toc-number">1.8.1.</span> <span class="post-toc-text">概述</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#关于-this-opts-defaultConfigFiles"><span class="post-toc-number">1.8.2.</span> <span class="post-toc-text">关于 this.opts.defaultConfigFiles</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#如何生成-umi"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">如何生成.umi</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#packages-preset-umi-src-commands-dev-dev-ts"><span class="post-toc-number">1.9.1.</span> <span class="post-toc-text">packages\preset-umi\src\commands\dev\dev.ts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#preset-umi-src-features-tmpFiles-tmpFiles-ts"><span class="post-toc-number">1.9.2.</span> <span class="post-toc-text">preset-umi\src\features\tmpFiles\tmpFiles.ts</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#tpl"><span class="post-toc-number">1.9.3.</span> <span class="post-toc-text">tpl</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#关键的commands-dev-dev-ts"><span class="post-toc-number">1.9.4.</span> <span class="post-toc-text">关键的commands\dev\dev.ts</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#umi-dev-过程源码分析"><span class="post-toc-number">2.</span> <span class="post-toc-text">umi dev 过程源码分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#过程概述"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">过程概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#准备过程"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">准备过程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#packages-umi-src-cli-forkedDev-ts"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">packages\umi\src\cli\forkedDev.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#packages-umi-src-service-service-ts"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">packages\umi\src\service\service.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（核心-umijs-core）-packages-core-src-service-service-ts"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">（核心@umijs/core） packages\core\src\service\service.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#packages-preset-umi-src-commands-dev-dev-ts-1"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">packages\preset-umi\src\commands\dev\dev.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#packages-bundler-webpack-src-dev-ts"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">packages\bundler-webpack\src\dev.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#packages-bundler-webpack-src-server-server-ts"><span class="post-toc-number">2.8.</span> <span class="post-toc-text">packages\bundler-webpack\src\server\server.ts</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#要点对象"><span class="post-toc-number">2.9.</span> <span class="post-toc-text">要点对象</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Service"><span class="post-toc-number">2.9.1.</span> <span class="post-toc-text">Service</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#webpack-config"><span class="post-toc-number">2.9.2.</span> <span class="post-toc-text">webpack.config</span></a></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/blog/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/blog/img/reward-wechat.jpg" data-alipay="/blog/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

        <footer class="footer">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Mr.Yellow &copy; 2017 - 2024
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://yewills.github.io/2022/05/06/umi_two/&title=《umi系列(二)：基础知识，如umi dev过程分析》 — Mr.Yellow.Wills&pic=https://yewills.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://yewills.github.io/2022/05/06/umi_two/&title=《umi系列(二)：基础知识，如umi dev过程分析》 — Mr.Yellow.Wills&source=hellow kity" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aS27DMAwFwNz/0u42QBv7kXQDWBqtAgWwNV4Q/Oj1itfxts53fv/7vl995s0LAwPjsYzjdCWHnlCT3+dnw8DA2IfxKYL1Hl14/WmATs6GgYGBMQ+vvcCNgYGBcVfATYrPPN3EwMDAOGckqd55wK022qrU22pxDAyMBzLyrvv3f//LfAMDA+NRjKO4zmHVllm1kffxLRgYGEsz8gDXa/HnQTzZv3gLBgbGooxJsMvBOSMJ7n/sYGBgbMZIkrZe+7567awwnMDAwFia0Ssmk1Z+PgBIBgyF5BIDA2M5xrzgrF626I0iLkIwBgbG0oxeW78XfPMUM09JCx1BDAyMJRiT6xe9oNxLEC8CLgYGxnKMefu+d4h8eBm15zAwMJZmVBO7pFlfva6Rjy2jkQAGBsZmjEkQ7F25mFwUw8DAWJVRbZxVBwDVnTxxvMhwMTAwFmUkh+uVr/cGXwwMjN0YeVGaDx0nITh58sePgoGBsTRj3sTPg2lyFaN3BQQDA2NtRnUkMGnJVW+C5GwMDIwdGNWxQZLwVdPH/JkYGBg7M+4KgnlQLsxak9wWAwNjOcZRXHl52Stre9fUMDAw1mbkKx9bTtptdw0kMDAw1mPkQbZa1k4+R/l7Y2BgbMDoBb7qMLJcYfdqcQwMjO0Zc/BkXHrRdMPAwMAoDi/nRWyevGJgYOzAmAwDRq9vjTkxMDB2Y1RLx/mxqoe4baiJgYHxPMYPGyjRP3oIgYcAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="/blog/js/plugins/jquery-2.1.1.min.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/fastclick.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/ios-orientationchange-fix.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/jquery.fancybox.min.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/MathJax.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/TeX-AMS-MML_HTMLorMML.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/MathMenu.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/plugins/MathZoom.js?v=1.3.9"></script>

<script type="text/javascript" src="/blog/js/plugins/waves.min.js?v=1.3.9"></script>

<script type="text/javascript" src="/blog/js/method.js?v=1.3.9"></script>
<script type="text/javascript" src="/blog/js/blog.js?v=1.3.9"></script>

<!-- third-party -->






<script type="text/javascript" src="/blog/js/plugins/local_search.js?v=1.3.9"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/blog/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src=""></script>







    
</body>
</html>
